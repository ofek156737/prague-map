<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="×¤×¨××’">
    <meta name="theme-color" content="#1a73e8">
    
    <title>××¤×ª ×¤×¨××’ ğŸ‡¨ğŸ‡¿</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
    const firebaseConfig = {
        apiKey: "AIzaSyBn54fVla6xqCZOcrvsHXOsFRGkDfCFc1A",
        authDomain: "prague-map-db.firebaseapp.com",
        databaseURL: "https://prague-map-db-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "prague-map-db",
        storageBucket: "prague-map-db.firebasestorage.app",
        messagingSenderId: "1035971189948",
        appId: "1:1035971189948:web:29486331114e738d7444b9",
        measurementId: "G-1YR58DS1E7"
    };
    
    // ××ª×—×•×œ Firebase ×•×”×’×“×¨×ª ×”××©×ª× ×” database ×©×™×”×™×” ×–××™×Ÿ ×œ×›×•×œ×
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    console.log("ğŸ”¥ Firebase connected!");
    </script>
    
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --primary-light: #e8f0fe;
            --secondary: #34a853;
            --warning: #f9ab00;
            --error: #ea4335;
            --background: #f8f9fa;
            --surface: #ffffff;
            --text: #202124;
            --text-secondary: #5f6368;
            --border: #dadce0;
            --shadow: 0 2px 8px rgba(0,0,0,0.15);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.2);
            --radius: 12px;
            --radius-lg: 20px;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Rubik', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            height: 100dvh;
        }
        
        .app { display: flex; flex-direction: column; height: 100vh; height: 100dvh; }
        
        /* Header */
        .header {
            background: var(--surface);
            padding: calc(var(--safe-top) + 8px) 16px 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .logo { display: flex; align-items: center; gap: 8px; font-size: 20px; font-weight: 600; color: var(--primary); }
        .header-buttons { display: flex; gap: 8px; }
        
        .btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
        }
        
        .btn:active { transform: scale(0.95); }
        .btn.secondary { background: var(--background); color: var(--text); }
        .btn.tracking { background: var(--secondary); }
        .btn svg { width: 18px; height: 18px; }
        
        /* Search */
        .search-container { position: relative; }
        
        .search-bar {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border: 2px solid var(--border);
            border-radius: 24px;
            font-size: 15px;
            outline: none;
            background: var(--background);
            font-family: inherit;
        }
        
        .search-bar:focus { border-color: var(--primary); background: var(--surface); }
        
        .search-icon {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .clear-search {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--border);
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .clear-search.visible { display: flex; }
        
        /* Search Results Dropdown */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 2000;
            display: none;
        }
        
        .search-results.visible { display: block; }
        
        .search-section-title {
            padding: 10px 16px 6px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            background: var(--background);
        }
        
        .search-result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
        }
        
        .search-result-item:last-child { border-bottom: none; }
        .search-result-item:active { background: var(--background); }
        
        .search-result-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .search-result-icon.google { background: #e8f0fe; }
        .search-result-info { flex: 1; min-width: 0; }
        .search-result-name { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .search-result-meta { font-size: 12px; color: var(--text-secondary); }
        .search-result-dist { font-size: 12px; color: var(--primary); font-weight: 500; }
        
        /* Categories */
        .categories {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 12px 16px;
            background: var(--surface);
            scrollbar-width: none;
        }
        
        .categories::-webkit-scrollbar { display: none; }
        
        .chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--background);
            border: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            font-family: inherit;
        }
        
        .chip.active { background: var(--primary); color: white; }
        .chip .count { background: rgba(0,0,0,0.1); padding: 2px 6px; border-radius: 10px; font-size: 11px; }
        .chip.active .count { background: rgba(255,255,255,0.3); }
        
        /* Main */
        .main-content { flex: 1; position: relative; overflow: hidden; }
        #map { width: 100%; height: 100%; z-index: 1; }
        
        /* List View */
        .list-view {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--background);
            overflow-y: auto;
            padding: 16px;
            padding-bottom: calc(100px + var(--safe-bottom));
            display: none;
            z-index: 500;
        }
        
        .list-view.active { display: block; }
        
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .place-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 14px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            display: flex;
            gap: 12px;
        }
        
        .place-card:active { transform: scale(0.98); }
        
        .place-icon {
            width: 52px;
            height: 52px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            flex-shrink: 0;
        }
        
        .place-info { flex: 1; min-width: 0; }
        .place-name { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
        .place-category { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; }
        .place-desc { font-size: 13px; color: var(--text-secondary); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .place-dist { font-size: 12px; color: var(--primary); font-weight: 500; margin-top: 4px; }
        
        /* View Toggle */
        .view-toggle {
            position: absolute;
            bottom: calc(80px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            background: var(--surface);
            border-radius: 25px;
            padding: 4px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
        }
        
        .view-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 18px;
            border: none;
            border-radius: 20px;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            color: var(--text-secondary);
        }
        
        .view-btn.active { background: var(--primary); color: white; }
        .view-btn svg { width: 18px; height: 18px; }
        
        /* Map Controls */
        .map-controls {
            position: absolute;
            bottom: calc(140px + var(--safe-bottom));
            right: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 1000;
        }
        
        .map-ctrl {
            width: 44px;
            height: 44px;
            background: var(--surface);
            border: none;
            border-radius: 50%;
            box-shadow: var(--shadow);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .map-ctrl:active { transform: scale(0.9); }
        .map-ctrl svg { width: 22px; height: 22px; color: var(--text); }
        
        /* Bottom Sheet */
        .sheet {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--surface);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            z-index: 2000;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            padding-bottom: var(--safe-bottom);
        }
        
        .sheet.open { transform: translateY(0); }
        
        .sheet-handle { width: 40px; height: 4px; background: var(--border); border-radius: 2px; margin: 12px auto; }
        
        .sheet-header-btns {
        position: absolute;
        top: 12px;
        left: 16px;
        display: flex;
        gap: 8px;
        z-index: 100;
    }

    .sheet-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(255,255,255,0.95);
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .sheet-btn:active { transform: scale(0.9); }
        
        .sheet-content { padding: 0 20px 20px; overflow-y: auto; flex: 1; }
        
        .sheet-header { display: flex; gap: 16px; margin-bottom: 16px; }
        
        .sheet-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            flex-shrink: 0;
        }
        
        .sheet-title { font-size: 20px; font-weight: 600; margin-bottom: 4px; }
        .sheet-subtitle { font-size: 14px; color: var(--text-secondary); }
        
        .info-box { padding: 12px 16px; border-radius: var(--radius); margin-bottom: 12px; }
        .info-box.distance { background: linear-gradient(135deg, #e8f5e9, #f1f8e9); display: flex; align-items: center; gap: 10px; }
        .info-box.distance svg { width: 22px; height: 22px; color: var(--secondary); }
        .info-box.distance span { font-size: 15px; font-weight: 600; color: #2e7d32; }
        .info-box.note { background: var(--primary-light); border-right: 4px solid var(--primary); }
        .info-box.note .label { font-size: 12px; font-weight: 600; color: var(--primary); margin-bottom: 4px; }
        .info-box.note .text { font-size: 14px; line-height: 1.5; }
        
        /* Actions */
        .actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }
        
        .action {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 4px;
            background: var(--background);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-family: inherit;
        }
        
        .action:active { transform: scale(0.95); background: var(--border); }
        .action svg { width: 24px; height: 24px; color: var(--primary); }
        .action span { font-size: 11px; font-weight: 500; }
        
        /* Google Embed */
        .google-section { background: var(--background); border-radius: var(--radius); overflow: hidden; margin-bottom: 16px; }
        .google-section-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; cursor: pointer; }
        .google-section-title { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .google-section-arrow { transition: transform 0.2s; }
        .google-section-arrow.expanded { transform: rotate(180deg); }
        .google-embed { height: 0; overflow: hidden; transition: height 0.3s; }
        .google-embed.visible { height: 350px; }
        .google-embed iframe { width: 100%; height: 100%; border: none; }
        
        .primary-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: inherit;
        }
        
        .primary-btn:active { transform: scale(0.98); background: var(--primary-dark); }
        .primary-btn svg { width: 22px; height: 22px; }
        
        /* Overlay */
        .overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 1500;
        }
        
        .overlay.visible { opacity: 1; visibility: visible; }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--surface);
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .modal.open { transform: translateX(0); }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: calc(var(--safe-top) + 12px) 16px 12px;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-title { font-size: 18px; font-weight: 600; }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; padding: 8px; }
        
        .modal-body { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: calc(var(--safe-bottom) + 80px); }
        
        .modal-footer {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            padding: 16px;
            padding-bottom: calc(var(--safe-bottom) + 16px);
            background: var(--surface);
            border-top: 1px solid var(--border);
        }
        
        /* Form */
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 16px;
            font-family: inherit;
            outline: none;
        }
        
        .form-input:focus { border-color: var(--primary); }
        .form-textarea { min-height: 100px; resize: vertical; }
        
        .form-select {
            appearance: none;
            background: var(--surface) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%235f6368' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat left 12px center;
            padding-left: 40px;
        }
        
        /* Tabs */
        .tabs { display: flex; border-bottom: 2px solid var(--border); margin-bottom: 16px; }
        
        .tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            font-family: inherit;
        }
        
        .tab.active { color: var(--primary); }
        .tab.active::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: var(--primary); }
        
        /* Editor Search */
        .editor-search {
            margin-bottom: 16px;
        }
        
        .editor-search input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            font-family: inherit;
            outline: none;
        }
        
        .editor-search input:focus { border-color: var(--primary); }
        
        /* Editor Items */
        .editor-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--background);
            border-radius: var(--radius);
            margin-bottom: 8px;
        }
        
        .editor-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }
        
        .editor-info { flex: 1; min-width: 0; }
        .editor-name { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .editor-meta { font-size: 12px; color: var(--text-secondary); }
        .editor-actions { display: flex; gap: 8px; }
        
        .editor-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .editor-btn.edit { background: var(--primary-light); }
        .editor-btn.delete { background: #fce8e6; }
        
        .add-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px;
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            background: none;
            color: var(--primary);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 16px;
            font-family: inherit;
        }
        
        .add-btn:active { background: var(--primary-light); }
        
        /* Pickers */
        .picker-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px; }
        
        .picker-item {
            aspect-ratio: 1;
            border: none;
            border-radius: 8px;
            font-size: 22px;
            cursor: pointer;
            background: var(--background);
        }
        
        .picker-item:active { transform: scale(0.9); }
        .picker-item.selected { background: var(--primary-light); box-shadow: 0 0 0 2px var(--primary); }
        
        .color-item { aspect-ratio: 1; border: 3px solid transparent; border-radius: 50%; cursor: pointer; }
        .color-item.selected { border-color: var(--text); transform: scale(1.1); }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(100px + var(--safe-bottom));
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 5000;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .toast.visible { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        /* Loading */
        .loading {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--surface);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading.hidden { opacity: 0; pointer-events: none; }
        
        .spinner { width: 50px; height: 50px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 16px; font-size: 16px; color: var(--text-secondary); }
/* Google Style Sheet Styles */
.sheet-hero {
    position: relative;
    margin: -20px -20px 16px -20px;
    display: none;
}

.sheet-hero.has-image { display: block; }

.sheet-photos-scroll {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
}

.sheet-photos-scroll::-webkit-scrollbar { display: none; }

.sheet-photo-item {
    flex: 0 0 100%;
    height: 220px;
    scroll-snap-align: start;
    object-fit: cover;
}

.sheet-photos-dots {
    display: flex;
    justify-content: center;
    gap: 6px;
    padding: 8px 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.3));
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
}

.sheet-photos-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255,255,255,0.5);
}

.sheet-photos-dot.active { background: white; }

.sheet-header-refined { margin-bottom: 12px; }
.sheet-title-large { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
.sheet-subtitle-row { display: flex; align-items: center; gap: 6px; font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; }

.rating-badge { display: flex; align-items: center; gap: 4px; font-weight: 600; }
.rating-star { color: #f9ab00; fill: currentColor; }
.rating-count { color: var(--text-secondary); font-weight: 400; }

/* Action Buttons Row */
.action-row {
    display: flex;
    gap: 12px;
    overflow-x: auto;
    padding-bottom: 8px;
    margin-bottom: 16px;
    scrollbar-width: none;
}
.action-btn {
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    min-width: 60px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--primary);
    font-family: inherit;
}
.action-btn-circle {
    width: 44px; height: 44px;
    border-radius: 50%;
    border: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    transition: all 0.2s;
}
.action-btn:active .action-btn-circle { background: var(--primary-light); border-color: var(--primary); }
.action-label { font-size: 11px; font-weight: 500; color: var(--text); }

.details-section { display: flex; flex-direction: column; gap: 16px; padding-bottom: 20px; }
.detail-item { display: flex; align-items: flex-start; gap: 12px; font-size: 14px; line-height: 1.5; }
.detail-icon { color: var(--text-secondary); width: 20px; margin-top: 2px; }

.my-notes-box {
    background: #f1f3f4;
    padding: 12px;
    border-radius: 8px;
    margin-top: 8px;
    border-right: 3px solid var(--primary);
}
/* Hours Section */
.hours-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}

.hours-toggle-icon {
    transition: transform 0.2s;
    font-size: 12px;
    color: var(--text-secondary);
}

.hours-toggle-icon.expanded {
    transform: rotate(180deg);
}

.hours-list {
    font-size: 13px;
}

.hours-day {
    padding: 4px 0;
    border-bottom: 1px solid var(--border);
}

.hours-day:last-child {
    border-bottom: none;
}

.hours-day.today {
    font-weight: 600;
    color: var(--primary);
    background: var(--primary-light);
    margin: 0 -8px;
    padding: 6px 8px;
    border-radius: 4px;
}
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">ğŸ‡¨ğŸ‡¿ ×˜×•×¢×Ÿ ××¤×ª ×¤×¨××’...</div>
    </div>
    
    <div class="app">
        <header class="header">
            <div class="header-top">
                <div class="logo">ğŸ‡¨ğŸ‡¿ ××¤×ª ×¤×¨××’</div>
                <div class="header-buttons">
                    <button class="btn secondary" onclick="openEditor()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    </button>
                    <button class="btn" id="locBtn" onclick="toggleLoc()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4m0 12v4M2 12h4m12 0h4"/></svg>
                        <span id="locText">××™×§×•×</span>
                    </button>
                </div>
            </div>
            <div class="search-container">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <input type="text" class="search-bar" id="searchInput" placeholder="×—×¤×© ××§×•× ×‘×¤×¨××’..." oninput="handleSearch(this.value)" onfocus="showSearchResults()">
                <button class="clear-search" id="clearBtn" onclick="clearSearch()">âœ•</button>
                
                <div class="search-results" id="searchResults"></div>
            </div>
        </header>
        
        <div class="categories" id="cats"></div>
        
        <main class="main-content">
            <div id="map"></div>
            <div class="list-view" id="listView"><div id="listContent"></div></div>
            
            <div class="map-controls">
                <button class="map-ctrl" onclick="goToMe()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4m0 12v4M2 12h4m12 0h4"/></svg></button>
                <button class="map-ctrl" onclick="fitAll()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><circle cx="15.5" cy="8.5" r="1.5"/><circle cx="8.5" cy="15.5" r="1.5"/><circle cx="15.5" cy="15.5" r="1.5"/></svg></button>
            </div>
            
            <div class="view-toggle">
                <button class="view-btn active" id="mapBtn" onclick="setView('map')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/></svg>××¤×”</button>
                <button class="view-btn" id="listBtn" onclick="setView('list')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>×¨×©×™××”</button>
            </div>
        </main>
    </div>
    
    <div class="overlay" id="overlay" onclick="closeSheet()"></div>
    
    <div class="sheet" id="sheet">
        <div class="sheet-handle"></div>
        <div class="sheet-header-btns">
            <button class="sheet-btn" onclick="closeSheet()">âœ•</button>
            <button class="sheet-btn" onclick="editSelectedPlace()">âœï¸</button>
        </div>
        <div class="sheet-content" id="sheetContent"></div>
    </div>
    
    <!-- Editor Modal -->
    <div class="modal" id="editorModal">
        <div class="modal-header">
            <button class="modal-close" onclick="closeEditor()">âœ•</button>
            <div class="modal-title">×¢×¨×™×›×ª ××¤×”</div>
            <div></div>
        </div>
        <div class="modal-body">
            <div class="tabs" id="editorTabs">
                <button class="tab active" data-tab="places">××§×•××•×ª</button>
                <button class="tab" data-tab="cats">×§×˜×’×•×¨×™×•×ª</button>
                <button class="tab" data-tab="settings">×”×’×“×¨×•×ª</button>
            </div>
            <div id="editorBody"></div>
        </div>
    </div>
    
    <!-- Place Modal -->
    <div class="modal" id="placeModal">
        <div class="modal-header">
            <button class="modal-close" onclick="closePlaceModal()">âœ•</button>
            <div class="modal-title" id="placeModalTitle">×”×•×¡×£ ××§×•×</div>
            <div></div>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">×—×™×¤×•×© ××§×•× ×‘-Google</label>
                <input type="text" class="form-input" id="googleSearchInput" placeholder="×”×§×œ×“ ×©× ××§×•×..." oninput="searchGoogleForAdd(this.value)">
                <div id="googleSearchResults" style="max-height:200px;overflow-y:auto;"></div>
            </div>
            <div class="form-group">
                <label class="form-label">×©× ×”××§×•×</label>
                <input type="text" class="form-input" id="pName" placeholder="×©× ×”××§×•×">
            </div>
            <div class="form-group">
                <label class="form-label">×§×˜×’×•×¨×™×”</label>
                <select class="form-input form-select" id="pCat"></select>
            </div>
            <div class="form-group">
                <label class="form-label">×ª×™××•×¨ / ×”×¢×¨×•×ª ××™×©×™×•×ª</label>
                <textarea class="form-input form-textarea" id="pDesc" placeholder="××” ××™×•×—×“ ×‘××§×•×?"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">×§×•××•×¨×“×™× ×˜×•×ª</label>
                <div style="display:flex;gap:8px;">
                    <input type="number" step="any" class="form-input" id="pLat" placeholder="Lat">
                    <input type="number" step="any" class="form-input" id="pLng" placeholder="Lng">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="primary-btn" onclick="savePlace()">ğŸ’¾ ×©××•×¨</button>
        </div>
    </div>
    
    <!-- Category Modal -->
    <div class="modal" id="catModal">
        <div class="modal-header">
            <button class="modal-close" onclick="closeCatModal()">âœ•</button>
            <div class="modal-title" id="catModalTitle">×”×•×¡×£ ×§×˜×’×•×¨×™×”</div>
            <div></div>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">×©× ×”×§×˜×’×•×¨×™×”</label>
                <input type="text" class="form-input" id="cName" placeholder="×œ×“×•×’××”: ××¡×¢×“×•×ª ××™×˜×œ×§×™×•×ª">
            </div>
            <div class="form-group">
            <label class="form-label">××™×™×§×•×Ÿ</label>
            <div style="display:flex;gap:12px;align-items:center;">
                <input type="text" class="form-input" id="emojiInput" style="width:80px;text-align:center;font-size:32px;" maxlength="2" value="ğŸ“" onclick="this.select()">
                <span style="color:var(--text-secondary);font-size:13px;">×œ×—×¥ ×•×‘×—×¨ ××™××•×’'×™ ××”××§×œ×“×ª</span>
            </div>
            <div style="margin-top:12px;">
                <div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px;">××• ×‘×—×¨ ××”×¨×©×™××”:</div>
                <div class="picker-grid" id="emojiPicker"></div>
            </div>
        </div>
            <div class="form-group">
                <label class="form-label">×¦×‘×¢</label>
                <div class="picker-grid" id="colorPicker" style="grid-template-columns:repeat(10,1fr);"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="primary-btn" onclick="saveCat()">ğŸ’¾ ×©××•×¨ ×§×˜×’×•×¨×™×”</button>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script>
    // === CONFIG ===
    const STORAGE = 'pragueMapV4';
    const GOOGLE_API_KEY = 'AIzaSyCTcnkFPH0BwuUeYcmU-8BpQqz3E-XxX9M';
    const PRAGUE_CENTER = { lat: 50.0755, lng: 14.4378 };
    
    const defaultCats = {
        '×”××‘×•×¨×’×¨×™×': { icon: 'ğŸ”', color: '#FF5252' },
        '×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™': { icon: 'ğŸ¥—', color: '#0F9D58', short: '×‘×™×¡×˜×¨×•/×—×œ×‘×™' },
        '×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×': { icon: 'â˜•', color: '#795548', short: '×§×¤×”/×§×™× ×•×—×™×' },
        '××¡×¢×“×•×ª ×›×œ×œ×™×•×ª': { icon: 'ğŸ½ï¸', color: '#FF9800', short: '××¡×¢×“×•×ª' },
        '××¡×¢×“×•×ª ×‘×©×¨×™×': { icon: 'ğŸ¥©', color: '#F57C00', short: '×‘×©×¨×™' },
        '××˜×¨×§×¦×™×•×ª': { icon: 'â­', color: '#9C27B0' },
        '×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£': { icon: 'ğŸ›ï¸', color: '#0288D1', short: '×©×•×¤×™× ×’' },
        '×©×•×•×§×™×': { icon: 'ğŸª', color: '#7CB342' },
        '×©×•×•×§×™ ×›×¨×™×¡××¡': { icon: 'ğŸ„', color: '#4CAF50', short: '×›×¨×™×¡××¡' },
        '×¡×•×©×™': { icon: 'ğŸ£', color: '#E91E63' }
    };
    
    const emojis = ['ğŸ”','ğŸ•','ğŸŒ®','ğŸ¥—','ğŸœ','ğŸ£','ğŸ¥©','ğŸ°','â˜•','ğŸº','ğŸ·','ğŸ¥','ğŸ§','ğŸ¦','â­','ğŸ›ï¸','ğŸ­','ğŸ¡','ğŸ›ï¸','ğŸª','ğŸ„','ğŸŒ³','â›ª','ğŸ°','ğŸŒ‰','ğŸš‡','ğŸ…¿ï¸','ğŸ¨','ğŸ’°','ğŸ“','â¤ï¸','âœ¨'];
    const colors = ['#FF5252','#FF4081','#E91E63','#9C27B0','#673AB7','#3F51B5','#2196F3','#03A9F4','#00BCD4','#009688','#4CAF50','#8BC34A','#CDDC39','#FFEB3B','#FFC107','#FF9800','#FF5722','#795548','#607D8B','#9E9E9E'];
    const initialData = [
  {
    "name": "VÃ½Äep U Zvonuâ€",
    "category": "×”××‘×•×¨×’×¨×™×",
    "description": "×”××œ×™×¦×• ×¤×” ×¢×œ ×¡×××©×‘×•×¨×’×¨",
    "lat": 50.0840644,
    "lng": 14.4230466
  },
  {
    "name": "FATFUCK smashed burgers VINOHRADSKÃ",
    "category": "×”××‘×•×¨×’×¨×™×",
    "description": "",
    "lat": 50.0771324,
    "lng": 14.4435489
  },
  {
    "name": "FATFUCK smash burgers",
    "category": "×”××‘×•×¨×’×¨×™×",
    "description": "",
    "lat": 50.0859346,
    "lng": 14.3828271
  },
  {
    "name": "FATFUCK smash burgers BRNOâ€",
    "category": "×”××‘×•×¨×’×¨×™×",
    "description": "×¡×××©×‘×•×¨×’×™× ××•×©×—×ª×™×",
    "lat": 49.1893288,
    "lng": 16.6009075
  },
  {
    "name": "Burgery & Bublinky",
    "category": "×”××‘×•×¨×’×¨×™×",
    "description": "",
    "lat": 50.0874428,
    "lng": 14.4541831
  },
  {
    "name": "Bistro Monk 2",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "",
    "lat": 50.0866257,
    "lng": 14.4050416
  },
  {
    "name": "Kampa Cafeâ€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "×‘×™×ª ×§×¤×” ×¤×¨×™×–××™",
    "lat": 50.0809143,
    "lng": 14.4068766
  },
  {
    "name": "Venueâ€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "×›×“××™ ×œ×§×—×ª ×¤× ×§×™×™×§×™× ×¢× ×‘× × ×•×ª ×¤×”",
    "lat": 50.0843167,
    "lng": 14.4205692
  },
  {
    "name": "Venue",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "",
    "lat": 50.0841314,
    "lng": 14.4208345
  },
  {
    "name": "Venue",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "",
    "lat": 50.0905113,
    "lng": 14.4203117
  },
  {
    "name": "GamberoRosso",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "",
    "lat": 50.0881018,
    "lng": 14.4250762
  },
  {
    "name": "×§×¤×” & ×•×•×¤×œ×™×",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "",
    "lat": 50.088011,
    "lng": 14.416783
  },
  {
    "name": "(A)void cafe",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "",
    "lat": 50.0750999,
    "lng": 14.4136634
  },
  {
    "name": "Ã´-mai Coffee & Brunchâ€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "",
    "lat": 50.0723362,
    "lng": 14.4361346
  },
  {
    "name": "L'Osteria - NÃ¡rodnÃ­â€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "××¡×¢×“×” ××™×˜×œ×§×™×ª",
    "lat": 50.0816542,
    "lng": 14.4173703
  },
  {
    "name": "Lâ€™Osteria PalÃ¡c KinskÃ½châ€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "××¡×¢×“×” ××™×˜×œ×§×™×ª",
    "lat": 50.0882136,
    "lng": 14.4216811
  },
  {
    "name": "L'Osteria - MasaryÄkaâ€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "××¡×¢×“×” ××™×˜×œ×§×™×ª",
    "lat": 50.0885531,
    "lng": 14.435377
  },
  {
    "name": "Cafe Letkaâ€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "×‘×™×ª ×§×¤×” ×¨××¡×˜×™ ×›×–×” ×œ××¨×•×—×ª ×‘×•×§×¨ × ×¨××” ×—××•×“",
    "lat": 50.0982405,
    "lng": 14.4253721
  },
  {
    "name": "Funwari Japanese Pancakesâ€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "×¤× ×§×™×™×§×™× ×™×¤× ×™×",
    "lat": 50.0799215,
    "lng": 14.4476426
  },
  {
    "name": "Funwari Japanese Delights",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "",
    "lat": 50.0790804,
    "lng": 14.4449359
  },
  {
    "name": "Bbred.â€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "××§×•× ×©×œ ××¨×•×—×•×ª ×‘×•×§×¨ ×‘×œ×—× × ×¨××” ×××© ×˜×•×‘",
    "lat": 50.0799103,
    "lng": 14.4515366
  },
  {
    "name": "Mamam Bistroâ€",
    "category": "×‘×™×¡×˜×¨×• / ××¨×•×—×•×ª ×‘×•×§×¨ / ×¤×™×¦×•×ª / ×—×œ×‘×™",
    "description": "×‘×™×¡×˜×¨×• ××¡×™×™××ª×™ × ×¨××” ××¢× ×™×™×Ÿ",
    "lat": 50.0740657,
    "lng": 14.4382261
  },
  {
    "name": "Yami Sushi Houseâ€",
    "category": "×¡×•×©×™",
    "description": "×××¨×• ×©×˜×¢×™× ×¤×” ×‘×¨××•×ª ×”×–×•×™×•×ª",
    "lat": 50.0894269,
    "lng": 14.4235624
  },
  {
    "name": "El Gaucho Melantrichova",
    "category": "××¡×¢×“×•×ª ×‘×©×¨×™×",
    "description": "",
    "lat": 50.0852574,
    "lng": 14.4211651
  },
  {
    "name": "El Gaucho | Celetna",
    "category": "××¡×¢×“×•×ª ×‘×©×¨×™×",
    "description": "",
    "lat": 50.0871162,
    "lng": 14.4265375
  },
  {
    "name": "El Gaucho DuÅ¡nÃ­",
    "category": "××¡×¢×“×•×ª ×‘×©×¨×™×",
    "description": "",
    "lat": 50.089279,
    "lng": 14.4215765
  },
  {
    "name": "El Gaucho DejvickÃ¡",
    "category": "××¡×¢×“×•×ª ×‘×©×¨×™×",
    "description": "",
    "lat": 50.0984254,
    "lng": 14.4002089
  },
  {
    "name": "HOSAROWA bbq&shabushabuâ€",
    "category": "××¡×¢×“×•×ª ×‘×©×¨×™×",
    "description": "××¡×¢×“×ª ×‘×©×¨×™× ×§×•×¨×™×× ×™×ª",
    "lat": 50.0846288,
    "lng": 14.4189219
  },
  {
    "name": "KantÃ½naâ€",
    "category": "××¡×¢×“×•×ª ×‘×©×¨×™×",
    "description": "×‘×¢×™×§×¨ ×‘×©×¨×™×",
    "lat": 50.0835041,
    "lng": 14.4289189
  },
  {
    "name": "Numaruâ€",
    "category": "××¡×¢×“×•×ª ×‘×©×¨×™×",
    "description": "××¡×¢×“×ª ×‘×©×¨×™× ×§×•×¨×™×× ×™×ª × ×¨××” ×˜×•×‘",
    "lat": 50.0899067,
    "lng": 14.4291101
  },
  {
    "name": "×”××¨×“ ×¨×•×§ ×§×¤×”",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "",
    "lat": 50.0866743,
    "lng": 14.4192144
  },
  {
    "name": "Hard Rock Cafe",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "",
    "lat": 50.1094314,
    "lng": 14.2691969
  },
  {
    "name": "Pasta Fresca",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "",
    "lat": 50.0872158,
    "lng": 14.4239611
  },
  {
    "name": "La Patrona DlouhÃ¡â€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××¡×¢×“×” ××§×¡×™×§× ×™×ª",
    "lat": 50.0897747,
    "lng": 14.4238031
  },
  {
    "name": "FAT CAT Old Town",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "",
    "lat": 50.0860664,
    "lng": 14.4187637
  },
  {
    "name": "FAT CAT Downtown",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "",
    "lat": 50.0811728,
    "lng": 14.4284426
  },
  {
    "name": "Takumi Ramen Quadrioâ€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "×¨×××Ÿ ×©×××¨×• ×©×× ×™ ×™×›×•×œ ×œ××›×•×œ ×©×!",
    "lat": 50.0813448,
    "lng": 14.4210027
  },
  {
    "name": "VÃ½Äepâ€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××•××¨×™× ×©×”×˜×¨×˜×¨ ×©× ×•×•××•",
    "lat": 50.0752439,
    "lng": 14.4536006
  },
  {
    "name": "Restaurace U KalendÅ¯â€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××•×›×œ ××§×•××™ ×¢× ×˜×™×™×§ ××•×“×¨× ×™ ××•××œ×¥ ×œ×§×—×ª ××ª ×”×©× ×™×¦×œ ××•××¨×™× ×•×•××•",
    "lat": 50.0713045,
    "lng": 14.4145502
  },
  {
    "name": "Baraqa Georgian Cuisineâ€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××¡×¢×“×” ×’×™××•×¨×’×™×ª ××•××œ×¦×ª",
    "lat": 50.0903324,
    "lng": 14.4224913
  },
  {
    "name": "KRO Vinohrady Bistroâ€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××•×›×œ ××§×•××™ ×›×–×” ××‘×œ ×¤× ×¡×™",
    "lat": 50.0771225,
    "lng": 14.45069
  },
  {
    "name": "LokÃ¡l DlouhÃ¡Ã¡Ã¡â€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××¡×¢×“×” ×‘×××ª ××§×•××™×ª ×‘××—×™×¨×™× × ××•×›×™× (×™×© ×©× ×’×•×œ××©)",
    "lat": 50.0906931,
    "lng": 14.4257574
  },
  {
    "name": "HavelskÃ¡ Korunaâ€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××•×›×œ ××§×•××™ ×©×××œ×™×¦×™× ×¢×œ×™×• ×”××•×Ÿ",
    "lat": 50.0855096,
    "lng": 14.4216261
  },
  {
    "name": "Sia Restaurantâ€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××¡×¢×“×” ××¡×™×™××ª×™×ª ×‘×¨××” ×’×‘×•×”×” ×©××•××¨×™× ×•×•××•",
    "lat": 50.0880172,
    "lng": 14.4307939
  },
  {
    "name": "Red chilli - Indian restaurantâ€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××¡×¢×“×” ×”×•×“×™×ª ××•××œ×¦×ª",
    "lat": 50.0711451,
    "lng": 14.4574995
  },
  {
    "name": "CafÃ© Imperialâ€",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "××¡×¢×“×” ×¢× ××•×›×œ ××§×•××™",
    "lat": 50.0897986,
    "lng": 14.4326642
  },
  {
    "name": "Popeyes Louisiana Kitchen",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "",
    "lat": 50.079947,
    "lng": 14.4289142
  },
  {
    "name": "Popeyes",
    "category": "××¡×¢×“×•×ª ×›×œ×œ×™×•×ª",
    "description": "",
    "lat": 50.0820869,
    "lng": 14.4194283
  },
  {
    "name": "Sensu cafe",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "",
    "lat": 50.0860949,
    "lng": 14.4706002
  },
  {
    "name": "Starbucksâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×¡×˜××¨×‘×§×¡ ×¢× × ×•×£",
    "lat": 50.0890815,
    "lng": 14.3985003
  },
  {
    "name": "BB GelatoğŸ‡¨ğŸ‡¿ğŸ‡¸ğŸ‡°â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×“×•×›×Ÿ ×’×œ×™×“×” ×©×ª×•××š ×‘×™×©×¨××œ ××– ×¦×¨×™×š ×œ×œ×›×ª",
    "lat": 50.0861191,
    "lng": 14.4170034
  },
  {
    "name": "Cinnamood Prague",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "",
    "lat": 50.0815356,
    "lng": 14.4222909
  },
  {
    "name": "Cinnamood Prague JZP",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "",
    "lat": 50.0770645,
    "lng": 14.4496994
  },
  {
    "name": "POP PAUSE POPCORN CAFEâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×¤×•×¤×§×•×¨×Ÿ ×‘××œ× ×˜×¢××™×",
    "lat": 50.0839471,
    "lng": 14.4277382
  },
  {
    "name": "ÄŒernÃ¡ Madonaâ€â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×¤×˜×™×¡×¨×™ ×¢× ×§×™× ×•×—×™× ××“×”×™××™× - ××•××¨×™× ×©×”×›×™ ×›×“××™ ×œ× ×¡×•×ª ××ª ×”×× ×’×•, ××’×•×– ×œ×•×–, ×ª×¤×•×— ×—××•×¥ ×•×§×•×§×•×¡",
    "lat": 50.0870823,
    "lng": 14.425554
  },
  {
    "name": "Taiyaki Barâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×‘×¨ ×§×™× ×•×—×™× ×¢× ×©×•×§×• ×¡××•×¨×¡ ×©×¦×¨×™×š ×œ× ×¡×•×ª!",
    "lat": 50.0882987,
    "lng": 14.418668
  },
  {
    "name": "KnedlÃ­nâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×›×“×•×¨ ××˜×•×’×Ÿ ××•××œ×¥ ×‘××œ× ×˜×¢××™× ×©×œ×”×",
    "lat": 50.0821709,
    "lng": 14.4189483
  },
  {
    "name": "artic Bakehouseâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×××¤×™×™×” ××•××œ×¦×ª",
    "lat": 50.0777093,
    "lng": 14.4166144
  },
  {
    "name": "artic Bakehouse",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "",
    "lat": 50.0803736,
    "lng": 14.4044684
  },
  {
    "name": "artic Bakehouse",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "",
    "lat": 50.0902428,
    "lng": 14.4352483
  },
  {
    "name": "Artic bakehouse",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "",
    "lat": 50.0813717,
    "lng": 14.4254123
  },
  {
    "name": "artic Bakehouse",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "",
    "lat": 50.0741629,
    "lng": 14.4321761
  },
  {
    "name": "Zrno Zrnko SenovÃ¡Å¾nÃ© nÃ¡mÄ›stÃ­â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×™×© ×©× ××ª ×”×§×™× ×•×— ×”××§×•××™ ×§×•×œ××¦'×”",
    "lat": 50.0854802,
    "lng": 14.4316932
  },
  {
    "name": "CafÃ© Savoyâ€â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "××•××œ×¥ ×œ××›×•×œ ×©× FRUIT DUMPLINGSâ€ ×•×’× ××—×œ×” ×©×•×§×•",
    "lat": 50.080972,
    "lng": 14.4072993
  },
  {
    "name": "BASAK HOTDOG (Korean Street Food & Corndog) - NÃ¡rodnÃ­ Branchâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "× ×§× ×™×§×™×™×” ×¢×œ ××§×œ ×§×•×¨×™×× ×™×ª",
    "lat": 50.0820691,
    "lng": 14.4174941
  },
  {
    "name": "CukrCafÃ© Blackulusâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×‘×™×ª ×§×¤×” ×”××¨×™ ×¤×•×˜×¨ - ×™×§×¨ ××‘×œ ××¤×©×¨ ×œ×œ×›×ª",
    "lat": 50.0751709,
    "lng": 14.428792
  },
  {
    "name": "CrÃ¨me de la CrÃ¨meâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×’×œ×™×“×” ×˜×•×‘×”",
    "lat": 50.0858082,
    "lng": 14.4182655
  },
  {
    "name": "Choco CafÃ©â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×©×•×§×• ××ª×•×§",
    "lat": 50.0845422,
    "lng": 14.4166454
  },
  {
    "name": "Cukrarna Mysakâ€â€â€â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×§×•× ×“×™×˜×•×¨×™×” ×‘×¢×™×¦×•×‘ ×©×œ ×¤×¢× × ×—×©×‘×ª ×œ×™×•×§×¨×ª×™×ª ×›×“××™ ×©×•×§×• ×—×›× ×•×©×¤×™×¦×§×” ×©×–×” ×§×¨××‘×• ×¢× ×œ×™×§×¨",
    "lat": 50.0812557,
    "lng": 14.4247099
  },
  {
    "name": "CukrÃ¡Å™ SkÃ¡laâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×§×•× ×“×™×˜×•×¨×™×” ×©×›×“××™ ×œ×˜×¢×•× ×§×¨××¨×•×œ×” ×××¤×” ×¢×œ×™× ××ª×•×§ ×××•×œ× ×‘×§×¦×™×¤×”",
    "lat": 50.0879214,
    "lng": 14.4307971
  },
  {
    "name": "Dolce menteâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×§×•× ×“×™×˜×•×¨×™×” ×¢× ×§×™× ×•×—×™× ×˜×•×‘×™×",
    "lat": 50.0766016,
    "lng": 14.4350748
  },
  {
    "name": "Kro Coffeeâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×××¤×™×™×” ××•××œ×¦×ª",
    "lat": 50.0771124,
    "lng": 14.4505203
  },
  {
    "name": "AntonÃ­novo pekaÅ™stvÃ­â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×××¤×™×™×” ××§×•××™×ª ××•××œ×¦×ª",
    "lat": 50.0749053,
    "lng": 14.4377229
  },
  {
    "name": "ESKA",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×××¤×™×™×” ×‘×™×ª ×§×¤×” ×¢× ×”×§×•×œ××¦' ×”×›×™ ×˜×•×‘ ×œ×¤×™ ××” ×©××•××¨×™×",
    "lat": 50.0913817,
    "lng": 14.4545739
  },
  {
    "name": "Eska LetnÃ¡â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×××¤×™×™×” ×‘×™×ª ×§×¤×” ×¢× ×”×§×•×œ××¦' ×”×›×™ ×˜×•×‘ ×œ×¤×™ ××” ×©××•××¨×™×",
    "lat": 50.100979,
    "lng": 14.4260565
  },
  {
    "name": "the italians wine foodâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "××§×•× ×©×œ ×§×™× ×•×—×™× ×•××¢×“× ×™×™×” × ×¨××” ×××© ×˜×•×‘",
    "lat": 50.0631245,
    "lng": 14.4103504
  },
  {
    "name": "KAVARNA Tvoje mÃ¡maâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×××¤×™×™×” ×‘×™×ª×™×ª ××•××œ×¦×ª",
    "lat": 50.0691319,
    "lng": 14.4579709
  },
  {
    "name": "Kus KolÃ¡Äeâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "××§×•× ××•××œ×¥ ×œ×××¤×™× ×•×§×•×œ××¦'",
    "lat": 50.07527,
    "lng": 14.4533989
  },
  {
    "name": "Kunsthalle CafÃ©â€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×§×¤×” ×©× ×¨××” × ×—××“ ×¢× × ×•×£",
    "lat": 50.0922631,
    "lng": 14.4095794
  },
  {
    "name": "Gingerbread Manâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×¢×•×’×™×•×ª GINGERBREAD",
    "lat": 50.0881725,
    "lng": 14.4100997
  },
  {
    "name": "TrdelnÃ­k & Coffeeâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×§×™×•×¨×˜×•×© ×›×–×” ×©×›×“××™ ×œ×§×—×ª ×¢× ×ª×•×ª×™× ×•×’×œ×™×“×”",
    "lat": 50.090041,
    "lng": 14.4180637
  },
  {
    "name": "CafÃ© Louvreâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×‘×™×ª ×§×¤×” ××•××œ×¥ ×‘×Ÿ ×™×•×ª×¨ 100 ×©× ×”",
    "lat": 50.0820693,
    "lng": 14.4186192
  },
  {
    "name": "IPPA CafÃ© Jungmannovaâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×‘×™×ª ×§×¤×” ×¢× ×§×™× ×•×—×™× ××¢× ×™×™× ×™×",
    "lat": 50.0812459,
    "lng": 14.4222612
  },
  {
    "name": "Mad rabbit - Macarons Barâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×‘×¨ ××§×¨×•× ×™×",
    "lat": 50.0872368,
    "lng": 14.4225927
  },
  {
    "name": "Furiantâ€",
    "category": "×‘×ª×™ ×§×¤×” / ×§×™× ×•×—×™× / × ×©× ×•×©×™×",
    "description": "×¤×•×¤ ××¤ ×××¤×™× ×©×©×•×•×” ×œ×‘×§×¨ × ×¨××”",
    "lat": 50.0817319,
    "lng": 14.4132162
  },
  {
    "name": "Old Town Squareâ€â€",
    "category": "×©×•×•×§×™ ×›×¨×™×¡××¡",
    "description": "××¡×•×¨×ª×™ ×•×”×›×™ ×’×“×•×œ, ×-10 ×‘×‘×•×§×¨ ×¢×“ 10 ×‘×¢×¨×‘",
    "lat": 50.0875692,
    "lng": 14.4211874
  },
  {
    "name": "NÃ¡mÄ›stÃ­ MÃ­ruâ€",
    "category": "×©×•×•×§×™ ×›×¨×™×¡××¡",
    "description": "×”××•×¢×“×£ ×¢×œ ×”××§×•××™×™× - ×-10 ×‘×‘×•×§×¨ ×¢×“ 8 ×‘×¢×¨×‘",
    "lat": 50.0747045,
    "lng": 14.43689
  },
  {
    "name": "NÃ¡mÄ›stÃ­ Republikyâ€â€",
    "category": "×©×•×•×§×™ ×›×¨×™×¡××¡",
    "description": "×©×•×§ ×§×˜×Ÿ ×™×•×ª×¨, ×-10 ×‘×‘×•×§×¨ ×¢×“ 8 ×‘×¢×¨×‘",
    "lat": 50.0881384,
    "lng": 14.4285174
  },
  {
    "name": "×›×™×›×¨ ×•××¦×œ×‘",
    "category": "×©×•×•×§×™ ×›×¨×™×¡××¡",
    "description": "×©×•×§ ×¤×•×¤×•×œ×¨×™ ×•×’×“×•×œ, ×-10 ×‘×‘×•×§×¨ ×¢×“ 10 ×‘×¢×¨×‘",
    "lat": 50.0810226,
    "lng": 14.4279917
  },
  {
    "name": "Tylovo NÃ¡mÄ›stÃ­â€",
    "category": "×©×•×•×§×™ ×›×¨×™×¡××¡",
    "description": "×-10 ×‘×‘×•×§×¨ ×¢×“ 8 ×‘×¢×¨×‘",
    "lat": 50.0748771,
    "lng": 14.4320475
  },
  {
    "name": "Na KampÄ›â€",
    "category": "×©×•×•×§×™ ×›×¨×™×¡××¡",
    "description": "×©×•×§ ×¨×•×× ×˜×™ ×•×¦×™×•×¨×™ ×-10 ×‘×‘×•×§×¨ ×œ-8 ×‘×¢×¨×‘",
    "lat": 50.0862711,
    "lng": 14.4085157
  },
  {
    "name": "Peace Squareâ€",
    "category": "×©×•×•×§×™ ×›×¨×™×¡××¡",
    "description": "×©×•×§ ×‘××•×•×™×¨×” ××©×¤×—×ª×™×ª ×-10 ×‘×‘×•×§×¨ ×¢×“ 8 ×‘×¢×¨×‘",
    "lat": 49.4403686,
    "lng": 12.9306427
  },
  {
    "name": "KarlÃ­n Squareâ€",
    "category": "×©×•×•×§×™ ×›×¨×™×¡××¡",
    "description": "×-12 ×¢×“ 8 ×‘×¢×¨×‘",
    "lat": 50.0925911,
    "lng": 14.4474684
  },
  {
    "name": "×’×Ÿ ×”×—×™×•×ª ×©×œ ×¤×¨××’",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "",
    "lat": 50.1177321,
    "lng": 14.4062013
  },
  {
    "name": "××¦×•×“×ª ×¤×¨××’",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "××¦×•×“×ª ×¤×¨××’ - ×”××ª×—× ×—×™× ×, ×”×›× ×™×¡×” ×œ×¢×œ×•×ª ×œ× ×§×•×“×ª ×ª×¦×¤×™×ª ××”×’×’ ×¢×•×œ×” ×›×¡×£ ×•××•××¨×™× ×©×©×•×•×” ×œ×¢×œ×•×ª.",
    "lat": 50.0910966,
    "lng": 14.4016165
  },
  {
    "name": "×’×©×¨ ×§××¨×œ - Charles bridge",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "××¤×©×¨ ×œ×¢×©×•×ª ×¤×” ×’× ×©×™×˜ ×‘× ×”×¨",
    "lat": 50.0864771,
    "lng": 14.4114366
  },
  {
    "name": "×¤×¡×œ ×”×¨××© ×”××¡×ª×•×‘×‘ ×©×œ ×¤×¨× ×¥ ×§×¤×§×",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "×›×œ ×¨×‘×¢ ×©×¢×” ×”×•× ××¡×ª×•×‘×‘",
    "lat": 50.0816514,
    "lng": 14.420821
  },
  {
    "name": "××©×—×§×™×” - LEVELS Pragueâ€",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "××œ× ×§×•××•×ª ×©×œ ××©×—×§×™×!",
    "lat": 50.082309,
    "lng": 14.4194829
  },
  {
    "name": "Choco-Story: Prague Chocolate Museumâ€",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "××•×–×™××•×Ÿ ×©×•×§×•×œ×“ ×©××¤×©×¨ ×œ×”×›×™×Ÿ ×œ×‘×“ ×•×œ×˜×¢×•×",
    "lat": 50.0871945,
    "lng": 14.4231733
  },
  {
    "name": "Prague Planetariumâ€â€â€",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "×¤×œ× ×˜×¨×™×•× ×¢× ×§ ×¢× ××¡×š 22 ××˜×¨ ×©××¦×™×’ ××œ× ×ª×›× ×™×, ×›×“××™ ×œ×¨×›×•×© ×›×™×¡××•×ª ×‘×—×œ×§ ×”××—×•×¨×™ - ××™×Ÿ ×›×¨×˜×™×¡×™× ××‘×œ ××•×œ×™ ×©×•×•×” ×œ×‘×“×•×§ ××ª×™ ×©× ×”×™×” ×©× (×œ× ××•×›×¨×™× ×›×¨×˜×™×¡×™× ×‘××§×•×)",
    "lat": 50.105526,
    "lng": 14.4276262
  },
  {
    "name": "Aquapalace Pragueâ€",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "×¤××¨×§ ××™× ××§×•×¨×”",
    "lat": 50.0074689,
    "lng": 14.5715265
  },
  {
    "name": "×”××•×–×™××•×Ÿ ×”×œ××•××™",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "× ×¨××” ×××© ×™×¤×”",
    "lat": 50.0789704,
    "lng": 14.4309369
  },
  {
    "name": "Choco Art Museum Pragueâ€",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "××•×–×™××•×Ÿ ×©×•×§×•×œ×“ ×©××¤×©×¨ ×œ×”×›×™×Ÿ ×•×œ××›×•×œ ×•×œ×˜×¢×•×",
    "lat": 50.0850344,
    "lng": 14.4181806
  },
  {
    "name": "Karl by ZEITRAUMâ€",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "×”××œ×•×Ÿ ×©×œ× ×•",
    "lat": 50.0773642,
    "lng": 14.4277819
  },
  {
    "name": "Prague's narrowest alley",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "",
    "lat": 50.0879538,
    "lng": 14.4095422
  },
  {
    "name": "MalÃ¡ Stranaâ€",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "×××œ×” ×¡×˜×¨× ×”, ×©× ×•×“×¢ ×’× ×‘×©× '×”×¢×™×¨ ×”×§×˜× ×”', ×”×•× ××–×•×¨ ×¢×œ ×¦×œ×¢ ×”×”×¨ ×©××©×§×™×£ ××¢×‘×¨ ×œ× ×”×¨ ×”×•×•×œ×˜××‘×” ××œ ×”×¢×™×¨ ×”×¢×ª×™×§×”. ×œ××•×¨×š ×”×¨×—×•×‘×•×ª ×”×¦×¨×™× ××¤×©×¨ ×œ××¦×•× ×‘×ª×™ ××œ×•×Ÿ, ××¡×¢×“×•×ª ×¤×©×•×˜×•×ª ×•×¤××‘×™× ××¡×•×¨×ª×™×™×, ×•×‘×§×™×¨ ×©×œ ×’'×•×Ÿ ×œ× ×•×Ÿ ××‘×§×¨×™× ××©××™×¨×™× ××¡×¨×™× ×œ×—×‘×¨ ×œ×”×§×ª ×”×‘×™×˜×œ×¡ ×©× ×¨×¦×—. ××–×•×¨ ×§××¤×” ×¢×œ ×©×¤×ª ×”× ×”×¨ ××¦×™×¢ ××¡×¢×“×•×ª ×’×•×¨××” ×•×›×Ÿ ×ª×¢×¨×•×›×” ×©×œ ×ª××•× ×•×ª ×•××›×ª×‘×™× ×‘××•×–×™××•×Ÿ ×¤×¨× ×¥ ×§×¤×§×. ×‘×’×Ÿ ×•×œ× ×©×˜×™×™×Ÿ ×˜×•×•×¡×™× ××¡×ª×•×‘×‘×™× ×—×•×¤×©×™.",
    "lat": 50.0877053,
    "lng": 14.4038934
  },
  {
    "name": "×”×§×™×¨ ×©×œ ×œ× ×•×Ÿ",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "",
    "lat": 50.0861079,
    "lng": 14.4065372
  },
  {
    "name": "Broadway Theatre",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "",
    "lat": 50.0866035,
    "lng": 14.4269854
  },
  {
    "name": "×”×©×¢×•×Ÿ ×”××¡×˜×¨×•× ×•××™ ×‘×¤×¨××’",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "",
    "lat": 50.0870215,
    "lng": 14.4207065
  },
  {
    "name": "Museum of Fantastic Illusions",
    "category": "××˜×¨×§×¦×™×•×ª",
    "description": "",
    "lat": 50.0810614,
    "lng": 14.424499
  },
  {
    "name": "×§× ×™×•×Ÿ ×¤×œ×“×™×•×",
    "category": "×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£",
    "description": "",
    "lat": 50.0892359,
    "lng": 14.4290386
  },
  {
    "name": "Westfield ÄŒernÃ½ Most",
    "category": "×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£",
    "description": "",
    "lat": 50.1079936,
    "lng": 14.5816581
  },
  {
    "name": "×•×•×¡×˜×¤×™×œ×“ ×—×•×“×•×‘",
    "category": "×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£",
    "description": "",
    "lat": 50.0304572,
    "lng": 14.4906768
  },
  {
    "name": "OC Quadrioâ€",
    "category": "×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£",
    "description": "×§× ×™×•×Ÿ ×—××•×“ ××‘×œ ×§×˜×Ÿ",
    "lat": 50.0816395,
    "lng": 14.4206758
  },
  {
    "name": "Fashion Arena Prague Outlet",
    "category": "×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£",
    "description": "",
    "lat": 50.0749392,
    "lng": 14.5389911
  },
  {
    "name": "×¤×¨×™×××¨×§",
    "category": "×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£",
    "description": "",
    "lat": 50.0809349,
    "lng": 14.4287463
  },
  {
    "name": "NovÃ½ SmÃ­chov Shopping Centreâ€",
    "category": "×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£",
    "description": "×§× ×™×•×Ÿ ×§×˜×Ÿ ×›×–×” ×¤×©×•×˜",
    "lat": 50.0731616,
    "lng": 14.4022526
  },
  {
    "name": "MI RYMAS EXCHANGEâ€",
    "category": "×©×•×¤×™× ×’ ×•×”××¨×ª ×›×¡×£",
    "description": "×¨××™×ª×™ ×”××œ×¦×” ×¢×œ ×”××§×•× ×”×–×”",
    "lat": 50.0827807,
    "lng": 14.4263432
  },
  {
    "name": "Farmers' Saturday marketâ€â€",
    "category": "×©×•×•×§×™×",
    "description": "×¤×•×¢×œ ×›×œ ×©×‘×ª ×‘×‘×•×§×¨ ×•×”×¦×”×¨×™×™× (××•××œ×¥ ×œ×”×’×™×¢ ×¢×“ ×¡×‘×™×‘×•×ª 12), ×—××•×“ ×××•×“, ××¤×©×¨ ×œ××¦×•× ×”××•×Ÿ ×“×•×›× ×™× ××§×•××™×™× ×•×¤×•×“ ×˜×¨××§×¡ ×©×•×•×™× ×¢× ××•×›×œ ×‘×™× ×œ××•××™. ×¤×ª×•×— ×¨×§ ×‘×©×‘×ª: 08:00-14:00",
    "lat": 50.0706661,
    "lng": 14.4140813
  },
  {
    "name": "Manifesto Market AndÄ›lâ€",
    "category": "×©×•×•×§×™×",
    "description": "×œ× ×‘×“×™×•×§ ×©×•×§ ××œ× ×—×œ×œ ××•×›×œ ××™×•×—×“. ×”××§×•× × ××¦× ×œ×™×“ ×§× ×™×•×Ÿ × ×•×‘×™-×¡××™×—×•×‘ ×”××¦×•×™×™×Ÿ, ×‘×©×•×§ ×¢××“×•×ª ××•×›×œ ××›×œ ×”×¡×•×’×™×, ××¤×©×¨ ×œ×©×œ×‘ ×•×œ×©×‘×ª ×‘×—×œ×œ ×”××¨×›×–×™, ×‘×§×™×¥ ×–×”×• ×©×•×§ ×¤×ª×•×— ×•× ×¢×™× ×•×‘×—×•×¨×£ ××§×•×¨×”. ××§×‘×œ×™× ×›×¨×˜×™×¡ ××©×¨××™ ×‘×œ×‘×“, ×œ×›×¡×£ ××–×•××Ÿ ××™×Ÿ ××§×•×, ×–×” ×”×× ×™×¤×¡×˜! ×¨×‘×™×¢×™-×¨××©×•×Ÿ: 11:00-22:00 ×©× ×™-×©×œ×™×©×™: ×¡×’×•×¨",
    "lat": 50.0693051,
    "lng": 14.4042358
  },
  {
    "name": "Tylovo nÃ¡mÄ›stÃ­ Marketâ€",
    "category": "×©×•×•×§×™×",
    "description": "×©×•×§ ×—××•×“ ×©×¤×ª×•×— ×‘××¨×‘×™×ª ×”×©×‘×•×¢, ×™×© ×œ×™×“ ×”×¨×‘×” ×‘×ª×™ ×§×¤×” ××¢×•×œ×™×, ×—× ×•×™×•×ª ×•××§×•××•×ª ××™×•×—×“×™× ×‘××¨×—×§ ×”×œ×™×›×”, ×œ××©×œ ×—× ×•×ª ×”Candy Store ×©××—×–×™×§×” ×××ª×§×™× ×•××•×¦×¨×™× ××™×•×—×“×™× ×××¨×¦×•×ª ×”×‘×¨×™×ª ×•×× ×’×œ×™×”. ×‘×™×Ÿ ×××¦×¢ ××¨×¥ ×œ×¡×•×£ ×“×¦××‘×¨ ×©× ×™-×©×™×©×™: 08:00-18:00 ×©×‘×ª-×¨××©×•×Ÿ: ×¡×’×•×¨",
    "lat": 50.0747974,
    "lng": 14.4322455
  }
]
;
    
    // Load/Save with Firebase
    let places = JSON.parse(JSON.stringify(initialData));
    let cats = JSON.parse(JSON.stringify(defaultCats));
    let firebaseReady = false;

    // ×©××™×¨×” ×œ-Firebase
    function save() {
        if (!firebaseReady) return;
        database.ref('mapData').set({
            places: places,
            cats: cats,
            lastUpdated: Date.now()
        }).catch(err => {
            console.error('Firebase save error:', err);
            toast('×©×’×™××” ×‘×©××™×¨×”');
        });
    }

    // ×˜×¢×™× ×” ×¨××©×•× ×™×ª + ×”××–× ×” ×œ×©×™× ×•×™×™× ×‘×–××Ÿ ×××ª
    function initFirebaseSync() {
        const dataRef = database.ref('mapData');
        
        // ×”××–× ×” ×œ×©×™× ×•×™×™× ×‘×–××Ÿ ×××ª
        dataRef.on('value', (snapshot) => {
            const data = snapshot.val();
            
            if (data) {
                // ×™×© × ×ª×•× ×™× ×‘-Firebase
                if (data.places) places = data.places;
                if (data.cats) cats = data.cats;
                console.log('ğŸ“¥ Data synced from Firebase');
            } else {
                // ××™×Ÿ × ×ª×•× ×™× - × ×©××•×¨ ××ª ×”× ×ª×•× ×™× ×”×”×ª×—×œ×ª×™×™×
                console.log('ğŸ“¤ Initializing Firebase with default data');
                save();
            }
            
            firebaseReady = true;
            
            // ×¨×¢× ×•×Ÿ ×”×ª×¦×•×’×”
            if (typeof renderCats === 'function') {
                renderCats();
                renderMarkers();
                renderList();
            }
        }, (error) => {
            console.error('Firebase read error:', error);
            toast('×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×');
            firebaseReady = true; // ×××©×™×›×™× ×¢× × ×ª×•× ×™× ××§×•××™×™×
        });
    }
    let map, markers = [], userMarker = null, userLoc = null, tracking = false, watchId = null;
    let activeCat = 'all', query = '', view = 'map', selected = null, selectedIdx = -1, sortByDist = true;
    let editIdx = -1, editCatId = null, selEmoji = 'ğŸ“', selColor = '#1a73e8';
    let editorPlaceSearch = '', editorCatSearch = '';
    let searchDebounce = null;
    
    // === INIT ===
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize Firebase sync
        initFirebaseSync();
        
        // Use Google Maps        
        document.querySelectorAll('#editorTabs .tab').forEach(t => {
            t.onclick = () => {
                document.querySelectorAll('#editorTabs .tab').forEach(x => x.classList.remove('active'));
                t.classList.add('active');
                renderEditorTab(t.dataset.tab);
            };
        });
        
        // Close search on click outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                document.getElementById('searchResults').classList.remove('visible');
            }
        });
        
        setTimeout(() => { document.getElementById('loading').classList.add('hidden'); }, 500);
    });
    
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: PRAGUE_CENTER,
            zoom: 14,
            disableDefaultUI: true,
            clickableIcons: true,
            mapId: "DEMO_MAP_ID"
            // styles ×”×•×¡×¨ ××›××Ÿ ×›×™ ×”×•× ××ª× ×’×© ×¢× mapId
        });
        
        // Add click listener for POIs
        map.addListener('click', (e) => {
            if (e.placeId) {
                e.stop();
                showGooglePlace(e.placeId);
            }
        });
        
        renderCats();
        renderMarkers();
        renderList();
        fitAll();
    }
    
    // === CATEGORIES ===
    function renderCats() {
        const c = document.getElementById('cats');
        const list = [...new Set(places.map(p => p.category))];
        c.innerHTML = `<button class="chip ${activeCat==='all'?'active':''}" onclick="filter('all')">ğŸ“ ×”×›×œ <span class="count">${places.length}</span></button>` +
            list.map(cat => {
                const cfg = cats[cat] || { icon: 'ğŸ“', color: '#999' };
                const cnt = places.filter(p => p.category === cat).length;
                return `<button class="chip ${activeCat===cat?'active':''}" onclick="filter('${cat.replace(/'/g, "\\'")}')">${cfg.icon} ${cfg.short||cat} <span class="count">${cnt}</span></button>`;
            }).join('');
    }
    
    function filter(cat) { activeCat = cat; renderCats(); renderMarkers(); renderList(); }
    
    // === MARKERS ===
    function renderMarkers() {
        markers.forEach(m => m.setMap(null));
        markers = [];
        
        getFiltered().forEach((p, i) => {
            const cfg = cats[p.category] || { icon: 'ğŸ“', color: '#999' };
            
            const markerDiv = document.createElement('div');
            markerDiv.innerHTML = `<div style="
                display:flex;align-items:center;justify-content:center;
                width:44px;height:44px;border-radius:50%;
                background:white;box-shadow:0 2px 8px rgba(0,0,0,0.3);
                font-size:22px;border:3px solid ${cfg.color};
                cursor:pointer;transition:transform 0.2s;
            ">${cfg.icon}</div>`;
            
            const marker = new google.maps.marker.AdvancedMarkerElement({
                map,
                position: { lat: p.lat, lng: p.lng },
                content: markerDiv,
                title: p.name
            });
            
            marker.addListener('click', () => openSheet(p, places.indexOf(p)));
            markers.push(marker);
        });
    }
    
    // === SEARCH ===
    function handleSearch(val) {
        query = val;
        document.getElementById('clearBtn').classList.toggle('visible', val.length > 0);
        
        if (val.length < 2) {
            document.getElementById('searchResults').classList.remove('visible');
            return;
        }
        
        clearTimeout(searchDebounce);
        searchDebounce = setTimeout(() => performSearch(val), 300);
    }
    
    function performSearch(val) {
        const resultsDiv = document.getElementById('searchResults');
        let html = '';
        
        // Search in my places
        const myResults = places.filter(p => 
            p.name.toLowerCase().includes(val.toLowerCase()) ||
            p.category.toLowerCase().includes(val.toLowerCase()) ||
            (p.description && p.description.toLowerCase().includes(val.toLowerCase()))
        ).slice(0, 5);
        
        if (myResults.length > 0) {
            html += '<div class="search-section-title">ğŸ“ ×”××§×•××•×ª ×©×œ×™</div>';
            myResults.forEach((p, i) => {
                const cfg = cats[p.category] || { icon: 'ğŸ“', color: '#999' };
                const d = userLoc ? `<div class="search-result-dist">${fmtDist(dist(userLoc.lat, userLoc.lng, p.lat, p.lng))}</div>` : '';
                html += `<div class="search-result-item" onclick="selectMyPlace(${places.indexOf(p)})">
                    <div class="search-result-icon" style="background:${cfg.color}20">${cfg.icon}</div>
                    <div class="search-result-info">
                        <div class="search-result-name">${p.name}</div>
                        <div class="search-result-meta">${p.category}</div>
                    </div>
                    ${d}
                </div>`;
            });
        }
        
        // Search Google Places
        html += '<div class="search-section-title">ğŸ” ×—×™×¤×•×© ×‘-Google</div>';
        html += '<div id="googleResults"><div style="padding:12px;color:var(--text-secondary);text-align:center;">××—×¤×©...</div></div>';
        
        resultsDiv.innerHTML = html;
        resultsDiv.classList.add('visible');
        
        // Google Places search
        const service = new google.maps.places.PlacesService(map);
        service.textSearch({
            query: val + ' Prague',
            location: PRAGUE_CENTER,
            radius: 10000
        }, (results, status) => {
            const googleDiv = document.getElementById('googleResults');
            if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                googleDiv.innerHTML = results.slice(0, 5).map(r => `
                    <div class="search-result-item" onclick="selectGoogleResult('${r.place_id}')">
                        <div class="search-result-icon google">ğŸ“</div>
                        <div class="search-result-info">
                            <div class="search-result-name">${r.name}</div>
                            <div class="search-result-meta">${r.formatted_address || ''}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                googleDiv.innerHTML = '<div style="padding:12px;color:var(--text-secondary);text-align:center;">×œ× × ××¦××• ×ª×•×¦××•×ª</div>';
            }
        });
    }
    
    function showSearchResults() {
        if (query.length >= 2) {
            document.getElementById('searchResults').classList.add('visible');
        }
    }
    
    function selectMyPlace(idx) {
        document.getElementById('searchResults').classList.remove('visible');
        document.getElementById('searchInput').value = '';
        query = '';
        document.getElementById('clearBtn').classList.remove('visible');
        openSheet(places[idx], idx);
    }
    
    function selectGoogleResult(placeId) {
        document.getElementById('searchResults').classList.remove('visible');
        document.getElementById('searchInput').value = '';
        query = '';
        document.getElementById('clearBtn').classList.remove('visible');
        showGooglePlace(placeId);
    }
    
    function showGooglePlace(placeId) {
        const service = new google.maps.places.PlacesService(map);
        service.getDetails({
            placeId: placeId,
            fields: ['name', 'formatted_address', 'geometry', 'rating', 'user_ratings_total', 'opening_hours', 'photos', 'website', 'formatted_phone_number', 'url']
        }, (place, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                // Check if it's in my places
                const existing = places.find(p => 
                    Math.abs(p.lat - place.geometry.location.lat()) < 0.0001 && 
                    Math.abs(p.lng - place.geometry.location.lng()) < 0.0001
                );
                
                if (existing) {
                    openSheet(existing, places.indexOf(existing));
                } else {
                    showGooglePlaceSheet(place);
                }
            }
        });
    }
    
    function showGooglePlaceSheet(place) {
        selected = {
            name: place.name,
            category: 'Google',
            lat: place.geometry.location.lat(),
            lng: place.geometry.location.lng(),
            googleData: place,
            isGoogle: true
        };
        selectedIdx = -1;
        
        map.panTo(place.geometry.location);
        map.setZoom(17);
        
        let html = `
            <div class="sheet-header">
                <div class="sheet-icon" style="background:#e8f0fe">ğŸ“</div>
                <div style="flex:1">
                    <div class="sheet-title">${place.name}</div>
                    <div class="sheet-subtitle">${place.formatted_address || ''}</div>
                </div>
            </div>
        `;
        
        if (userLoc) {
            const d = dist(userLoc.lat, userLoc.lng, place.geometry.location.lat(), place.geometry.location.lng());
            html += `<div class="info-box distance"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg><span>${fmtDist(d)} ×××š</span></div>`;
        }
        
        if (place.rating) {
            html += `<div class="info-box" style="background:#fff8e1;display:flex;align-items:center;gap:12px;">
                <span style="font-size:24px;font-weight:700;">${place.rating}</span>
                <div>
                    <div style="color:#f9ab00;">${'â˜…'.repeat(Math.round(place.rating))}${'â˜†'.repeat(5-Math.round(place.rating))}</div>
                    <div style="font-size:12px;color:var(--text-secondary);">${place.user_ratings_total?.toLocaleString() || 0} ×‘×™×§×•×¨×•×ª</div>
                </div>
            </div>`;
        }
        
        if (place.opening_hours) {
            const isOpen = place.opening_hours.isOpen?.();
            html += `<div class="info-box" style="background:${isOpen ? '#e8f5e9' : '#fce8e6'}">
                <span style="font-weight:600;color:${isOpen ? '#2e7d32' : '#c5221f'}">${isOpen ? 'ğŸŸ¢ ×¤×ª×•×— ×¢×›×©×™×•' : 'ğŸ”´ ×¡×’×•×¨'}</span>
            </div>`;
        }
        
        const googleUrl = place.url || `https://www.google.com/maps/place/?q=place_id:${place.place_id}`;
        
        html += `
            <div class="actions">
                <button class="action" onclick="navigateToCoords(${place.geometry.location.lat()}, ${place.geometry.location.lng()})">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>
                    <span>× ×™×•×•×˜</span>
                </button>
                <button class="action" onclick="window.open('${googleUrl}','_blank')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                    <span>Google Maps</span>
                </button>
                <button class="action" onclick="addGooglePlaceToMyList()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                    <span>×”×•×¡×£ ×œ×¨×©×™××”</span>
                </button>
                <button class="action" onclick="searchPhotosFor('${place.name.replace(/'/g, "\\'")}')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>
                    <span>×ª××•× ×•×ª</span>
                </button>
            </div>
        `;
        
        // Photos
        if (place.photos && place.photos.length > 0) {
            html += `<div style="margin-bottom:16px;">
                <div style="font-weight:600;margin-bottom:8px;">ğŸ“¸ ×ª××•× ×•×ª</div>
                <div style="display:flex;gap:8px;overflow-x:auto;">
                    ${place.photos.slice(0, 5).map(p => `<img src="${p.getUrl({maxWidth:150})}" style="width:100px;height:100px;border-radius:8px;object-fit:cover;">`).join('')}
                </div>
            </div>`;
        }
        
        html += `<button class="primary-btn" onclick="navigateToCoords(${place.geometry.location.lat()}, ${place.geometry.location.lng()})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>
            ×”×ª×—×œ × ×™×•×•×˜
        </button>`;
        
        document.getElementById('sheetContent').innerHTML = html;
        document.getElementById('sheet').classList.add('open');
        document.getElementById('overlay').classList.add('visible');
    }
    
    function addGooglePlaceToMyList() {
        if (!selected || !selected.isGoogle) return;
        
        editIdx = -1;
        document.getElementById('placeModalTitle').textContent = '×”×•×¡×£ ×œ×¨×©×™××” ×©×œ×™';
        document.getElementById('pName').value = selected.name;
        document.getElementById('pDesc').value = '';
        document.getElementById('pLat').value = selected.lat;
        document.getElementById('pLng').value = selected.lng;
        document.getElementById('pCat').innerHTML = Object.keys(cats).map(c => `<option value="${c}">${cats[c].icon} ${c}</option>`).join('');
        document.getElementById('googleSearchInput').value = '';
        document.getElementById('googleSearchResults').innerHTML = '';
        
        closeSheet();
        document.getElementById('placeModal').classList.add('open');
    }
    
    function clearSearch() {
        document.getElementById('searchInput').value = '';
        query = '';
        document.getElementById('clearBtn').classList.remove('visible');
        document.getElementById('searchResults').classList.remove('visible');
        renderMarkers();
        renderList();
    }
    
    // === LIST ===
    function renderList() {
        let list = getFiltered();
        
        if (sortByDist && userLoc) {
            list = [...list].sort((a, b) => 
                dist(userLoc.lat, userLoc.lng, a.lat, a.lng) - 
                dist(userLoc.lat, userLoc.lng, b.lat, b.lng)
            );
        } else {
            list = [...list].sort((a, b) => a.name.localeCompare(b.name, 'he'));
        }
        
        document.getElementById('listContent').innerHTML = `
            <div class="list-header">
                <div>
                    <div style="font-size:18px;font-weight:600;">××§×•××•×ª</div>
                    <div style="color:var(--text-secondary);font-size:14px;">${list.length} ××§×•××•×ª</div>
                </div>
                <button class="btn secondary" onclick="toggleSort()">ğŸ“Š ${sortByDist ? '××¨×—×§' : '×-×‘'}</button>
            </div>
        ` + (list.length ? list.map(p => {
            const cfg = cats[p.category] || { icon: 'ğŸ“', color: '#999' };
            const d = userLoc ? fmtDist(dist(userLoc.lat, userLoc.lng, p.lat, p.lng)) : '';
            const idx = places.indexOf(p);
            return `<div class="place-card" onclick="openSheet(places[${idx}], ${idx})">
                <div class="place-icon" style="background:${cfg.color}20">${cfg.icon}</div>
                <div class="place-info">
                    <div class="place-name">${p.name}</div>
                    <div class="place-category">${p.category}</div>
                    ${p.description ? `<div class="place-desc">${p.description}</div>` : ''}
                    ${d ? `<div class="place-dist">ğŸ“ ${d}</div>` : ''}
                </div>
            </div>`;
        }).join('') : '<div style="text-align:center;padding:60px 20px;color:var(--text-secondary)"><div style="font-size:64px">ğŸ”</div><div style="font-size:18px;font-weight:600;margin-top:16px">×œ× × ××¦××• ×ª×•×¦××•×ª</div></div>');
    }
    
    function getFiltered() {
        return places.filter(p => {
            const mc = activeCat === 'all' || p.category === activeCat;
            return mc;
        });
    }
    
    function toggleSort() {
        sortByDist = !sortByDist;
        renderList();
    }
    
    // === VIEW ===
    function setView(v) {
        view = v;
        document.getElementById('mapBtn').classList.toggle('active', v === 'map');
        document.getElementById('listBtn').classList.toggle('active', v === 'list');
        document.getElementById('listView').classList.toggle('active', v === 'list');
        if (v === 'map') google.maps.event.trigger(map, 'resize');
    }
    
    // === LOCATION ===
    function toggleLoc() { tracking ? stopLoc() : startLoc(); }
    
    function startLoc() {
        if (!navigator.geolocation) { toast('×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘××™×§×•×'); return; }
        document.getElementById('locBtn').classList.add('tracking');
        document.getElementById('locText').textContent = '×¢×•×§×‘...';
        
        watchId = navigator.geolocation.watchPosition(pos => {
            userLoc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            
            if (userMarker) {
                userMarker.position = userLoc;
            } else {
                const div = document.createElement('div');
                div.innerHTML = '<div style="width:18px;height:18px;background:#1a73e8;border:3px solid white;border-radius:50%;box-shadow:0 0 0 6px rgba(26,115,232,0.25);"></div>';
                userMarker = new google.maps.marker.AdvancedMarkerElement({
                    map,
                    position: userLoc,
                    content: div
                });
            }
            
            tracking = true;
            document.getElementById('locText').textContent = '×¤×¢×™×œ';
            renderList();
        }, () => { toast('×œ× × ×™×ª×Ÿ ×œ×’×©×ª ×œ××™×§×•×'); stopLoc(); }, 
        { enableHighAccuracy: true, maximumAge: 10000, timeout: 10000 });
    }
    
    function stopLoc() {
        if (watchId) navigator.geolocation.clearWatch(watchId);
        watchId = null; tracking = false;
        document.getElementById('locBtn').classList.remove('tracking');
        document.getElementById('locText').textContent = '××™×§×•×';
        if (userMarker) { userMarker.map = null; userMarker = null; }
    }
    
    function goToMe() { 
        if (userLoc) map.panTo(userLoc); 
        else { startLoc(); toast('×××ª×¨ ××™×§×•×...'); } 
    }
    
    function fitAll() { 
        if (!places.length) return; 
        const bounds = new google.maps.LatLngBounds();
        places.forEach(p => bounds.extend({ lat: p.lat, lng: p.lng }));
        map.fitBounds(bounds, 40);
    }
    
    // === SHEET ===
    function openSheet(p, idx) {
        selected = p;
        selectedIdx = idx;
        
        // ×©×œ×‘ 1: ×”×¦×’×” ××™×™×“×™×ª ×©×œ ×”××™×“×¢ ×”××§×•××™ ×©×™×© ×œ× ×•
        renderRichSheet(p, null);
        document.getElementById('sheet').classList.add('open');
        document.getElementById('overlay').classList.add('visible');

        // ×©×œ×‘ 2: × ×™×¡×™×•×Ÿ ×œ××©×•×š ××™×“×¢ × ×•×¡×£ ××’×•×’×œ
        const service = new google.maps.places.PlacesService(map);
        
        // ×ª×™×§×•×Ÿ: ××‘×§×©×™× ×¨×§ ×©×“×•×ª ×‘×¡×™×¡×™×™× ×œ×—×™×¤×•×© ×”×¨××©×•× ×™ ×›×“×™ ×œ×× ×•×¢ ×©×’×™××”
        const request = {
            query: p.name + " Prague",
            fields: ['name', 'geometry', 'place_id', 'formatted_address', 'photos'] 
        };

        service.findPlaceFromQuery(request, (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK && results && results[0]) {
                // × ××¦××” ×”×ª×××”! ×¢×›×©×™×• ××•×©×›×™× ××ª ×›×œ ×”×¤×¨×˜×™× ×”××œ××™× (×›×•×œ×œ ×˜×œ×¤×•×Ÿ ×•××ª×¨)
                service.getDetails({ 
                    placeId: results[0].place_id,
                    fields: ['name', 'photos', 'formatted_address', 'rating', 'user_ratings_total', 'opening_hours', 'geometry', 'place_id', 'formatted_phone_number', 'website', 'url']
                }, (placeDetails, detailStatus) => {
                     if (detailStatus === google.maps.places.PlacesServiceStatus.OK) {
                         renderRichSheet(p, placeDetails);
                     } else {
                         console.log('Google Details Error:', detailStatus);
                     }
                });
            } else {
                if (status !== 'OK' && status !== 'ZERO_RESULTS') {
                    console.log('Google Search Error:', status);
                    // toast('×©×’×™××ª ×’×•×’×œ: ' + status); // ××¤×©×¨ ×œ×”×—×–×™×¨ ×× ×¨×•×¦×™× ×“×™×‘×•×’
                }
            }
        });

        if (view === 'map') {
            map.panTo({ lat: p.lat, lng: p.lng });
            map.setZoom(17);
        }
    }

// ×¤×•× ×§×¦×™×™×ª ×”×¢×–×¨ ×©×‘×•× ×” ××ª ×”-HTML ×”×™×¤×”
function renderRichSheet(localPlace, googlePlace) {
    const cfg = cats[localPlace.category] || { icon: 'ğŸ“', color: '#999' };
    
    // ×‘×¨×™×¨×ª ××—×“×œ ×œ× ×ª×•× ×™×
    let photosHtml = '';
    let ratingHtml = '';
    let address = '×¤×¨××’, ×¦×³×›×™×”';
    let hoursHtml = '';
    let website = '';
    let phone = '';
    let gLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(localPlace.name + ' Prague')}`;

    if (googlePlace) {
        // ×’×œ×¨×™×™×ª ×ª××•× ×•×ª - ×¢×“ 15 ×ª××•× ×•×ª
        if (googlePlace.photos && googlePlace.photos.length > 0) {
            const photos = googlePlace.photos.slice(0, 15);
            photosHtml = `
                <div class="sheet-hero has-image">
                    <div class="sheet-photos-scroll" id="photosScroll">
                        ${photos.map((p, i) => `<img class="sheet-photo-item" src="${p.getUrl({ maxWidth: 600 })}" alt="×ª××•× ×” ${i+1}">`).join('')}
                    </div>
                    ${photos.length > 1 ? `
                    <div class="sheet-photos-dots">
                        ${photos.map((_, i) => `<div class="sheet-photos-dot ${i === 0 ? 'active' : ''}" data-index="${i}"></div>`).join('')}
                    </div>` : ''}
                </div>
            `;
        }
        
        if (googlePlace.rating) {
            ratingHtml = `
                <div class="rating-badge">
                    <span>${googlePlace.rating}</span>
                    <svg class="rating-star" width="14" height="14" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                    <span class="rating-count">(${googlePlace.user_ratings_total?.toLocaleString()})</span>
                </div>
            `;
        }
        
        if (googlePlace.formatted_address) address = googlePlace.formatted_address;
        
        // ×©×¢×•×ª ×¤×ª×™×—×” ××œ××•×ª - ×‘×“×™×§×” ×œ×¤×™ ×©×¢×•×Ÿ ×¤×¨××’
        if (googlePlace.opening_hours) {
            const weekdayText = googlePlace.opening_hours.weekday_text || [];
            
            // ×—×™×©×•×‘ ×”×©×¢×” ×”× ×•×›×—×™×ª ×‘×¤×¨××’ (Europe/Prague timezone)
            const pragueTime = new Date().toLocaleString('en-US', { timeZone: 'Europe/Prague' });
            const pragueDate = new Date(pragueTime);
            const pragueDay = pragueDate.getDay(); // 0=Sunday
            const pragueHour = pragueDate.getHours();
            const pragueMinute = pragueDate.getMinutes();
            const currentTimeMinutes = pragueHour * 60 + pragueMinute;
            
            // ×”××¨×ª ×™×•× ×œ××™× ×“×§×¡ ×©×œ Google (0=Monday ×‘×’×•×’×œ)
            const googleDayIndex = pragueDay === 0 ? 6 : pragueDay - 1;
            
            // ×‘×“×™×§×” ×”×× ×¤×ª×•×— ×¢×›×©×™×• ×œ×¤×™ ×”×˜×§×¡×˜
            let isOpen = false;
            if (weekdayText[googleDayIndex]) {
                const todayHours = weekdayText[googleDayIndex];
                // ×¤×•×¨××˜: "Monday: 11:00 AM â€“ 11:00 PM" ××• "Monday: Closed"
                if (!todayHours.toLowerCase().includes('closed') && !todayHours.includes('×¡×’×•×¨')) {
                    const timeMatch = todayHours.match(/(\d{1,2}):(\d{2})\s*(AM|PM)?\s*[â€“-]\s*(\d{1,2}):(\d{2})\s*(AM|PM)?/i);
                    if (timeMatch) {
                        let openHour = parseInt(timeMatch[1]);
                        const openMin = parseInt(timeMatch[2]);
                        let closeHour = parseInt(timeMatch[4]);
                        const closeMin = parseInt(timeMatch[5]);
                        
                        // ×”××¨×” ×œ×¤×•×¨××˜ 24 ×©×¢×•×ª ×× ×™×© AM/PM
                        if (timeMatch[3]?.toUpperCase() === 'PM' && openHour !== 12) openHour += 12;
                        if (timeMatch[3]?.toUpperCase() === 'AM' && openHour === 12) openHour = 0;
                        if (timeMatch[6]?.toUpperCase() === 'PM' && closeHour !== 12) closeHour += 12;
                        if (timeMatch[6]?.toUpperCase() === 'AM' && closeHour === 12) closeHour = 0;
                        
                        const openTimeMinutes = openHour * 60 + openMin;
                        let closeTimeMinutes = closeHour * 60 + closeMin;
                        
                        // ×× ×©×¢×ª ×”×¡×’×™×¨×” ×§×˜× ×” ××©×¢×ª ×”×¤×ª×™×—×”, ×–×” ××•××¨ ×©× ×¡×’×¨ ××—×¨×™ ×—×¦×•×ª
                        if (closeTimeMinutes < openTimeMinutes) {
                            closeTimeMinutes += 24 * 60;
                        }
                        
                        isOpen = currentTimeMinutes >= openTimeMinutes && currentTimeMinutes < closeTimeMinutes;
                    }
                }
            }
            
            hoursHtml = `
                <div class="detail-item hours-section">
                    <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    <div style="flex:1;">
                        <div class="hours-header" onclick="toggleHoursExpand()">
                            <span style="color:${isOpen ? '#188038' : '#d93025'}; font-weight:600;">${isOpen ? 'ğŸŸ¢ ×¤×ª×•×— ×¢×›×©×™×•' : 'ğŸ”´ ×¡×’×•×¨'}</span>
                            <span class="hours-toggle-icon" id="hoursToggleIcon">â–¼</span>
                        </div>
                        <div class="hours-list" id="hoursList" style="display:none; margin-top:8px;">
                            ${weekdayText.map((day, i) => {
                                return `<div class="hours-day ${i === googleDayIndex ? 'today' : ''}">${day}</div>`;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        if (googlePlace.website) website = googlePlace.website;
        if (googlePlace.formatted_phone_number) phone = googlePlace.formatted_phone_number;
        if (googlePlace.url) gLink = googlePlace.url;
    }

    const html = `
        ${photosHtml}
        
        <div class="sheet-header-refined">
            <div class="sheet-title-large">${localPlace.name}</div>
            <div class="sheet-subtitle-row">
                <span>${localPlace.category}</span>
                ${ratingHtml ? 'â€¢' : ''}
                ${ratingHtml}
            </div>
        </div>

        <div class="action-row">
            <button class="action-btn" onclick="navigateToCoords(${localPlace.lat}, ${localPlace.lng})">
                <div class="action-btn-circle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg></div>
                <span class="action-label">× ×™×•×•×˜</span>
            </button>
            <button class="action-btn" onclick="viewOnOurMap(${localPlace.lat}, ${localPlace.lng})">
                <div class="action-btn-circle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg></div>
                <span class="action-label">×¦×¤×” ×‘××¤×”</span>
            </button>
            <button class="action-btn" onclick="showRelativeLocation(${localPlace.lat}, ${localPlace.lng})">
                <div class="action-btn-circle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4m0 12v4M2 12h4m12 0h4"/><path d="M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg></div>
                <span class="action-label">×‘×™×—×¡ ××œ×™×™</span>
            </button>
            <button class="action-btn" onclick="window.open('${gLink}', '_blank')">
                <div class="action-btn-circle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg></div>
                <span class="action-label">Google Maps</span>
            </button>
            ${website ? `
            <button class="action-btn" onclick="window.open('${website}', '_blank')">
                <div class="action-btn-circle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg></div>
                <span class="action-label">××ª×¨</span>
            </button>` : ''}
            ${phone ? `
            <button class="action-btn" onclick="window.location.href='tel:${phone}'">
                <div class="action-btn-circle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg></div>
                <span class="action-label">×©×™×—×”</span>
            </button>` : ''}
            <button class="action-btn" onclick="share()">
                <div class="action-btn-circle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></div>
                <span class="action-label">×©×™×ª×•×£</span>
            </button>
        </div>

        <div class="details-section">
            <div class="detail-item">
                <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                <div>
                    <div>${address}</div>
                    ${userLoc ? `<div style="color:var(--primary); font-weight:500; margin-top:2px;">${fmtDist(dist(userLoc.lat, userLoc.lng, localPlace.lat, localPlace.lng))} ×××š</div>` : ''}
                </div>
            </div>
            
            ${hoursHtml}

            ${localPlace.description ? `
            <div class="my-notes-box">
                <div style="font-weight:600; font-size:12px; margin-bottom:4px; color:var(--text-secondary);">ğŸ“ ×”×”×¢×¨×•×ª ×©×œ×™:</div>
                <div style="line-height:1.4;">${localPlace.description}</div>
            </div>` : ''}
        </div>

        <button class="primary-btn" onclick="navigateToCoords(${localPlace.lat}, ${localPlace.lng})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 11l19-9-9 19-2-8-8-2z"/></svg>
            ×”×ª×—×œ × ×™×•×•×˜
        </button>
    `;
    
    document.getElementById('sheetContent').innerHTML = html;
    
    // ×”×•×¡×¤×ª event listener ×œ×’×œ×¨×™×™×ª ×”×ª××•× ×•×ª
    setTimeout(() => {
        const scroll = document.getElementById('photosScroll');
        if (scroll) {
            scroll.addEventListener('scroll', () => {
                const index = Math.round(scroll.scrollLeft / scroll.offsetWidth);
                document.querySelectorAll('.sheet-photos-dot').forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            });
        }
    }, 100);
}
    // ×¤×•× ×§×¦×™×” ×œ×¤×ª×™×—×ª/×¡×’×™×¨×ª ×©×¢×•×ª ×¤×ª×™×—×”
function toggleHoursExpand() {
    const list = document.getElementById('hoursList');
    const icon = document.getElementById('hoursToggleIcon');
    if (list.style.display === 'none') {
        list.style.display = 'block';
        icon.classList.add('expanded');
    } else {
        list.style.display = 'none';
        icon.classList.remove('expanded');
    }
}

// ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ××™×§×•× ×‘×™×—×¡ ×œ××©×ª××©
function showRelativeLocation(placeLat, placeLng) {
    if (!userLoc) {
        toast('×™×© ×œ×”×¤×¢×™×œ ××™×§×•× ×§×•×“×');
        startLoc();
        return;
    }
    
    closeSheet();
    setView('map');
    
    // ×”×ª×××ª ×”××¤×” ×œ×”×¦×’×ª ×©× ×™ ×”××™×§×•××™×
    const bounds = new google.maps.LatLngBounds();
    bounds.extend({ lat: userLoc.lat, lng: userLoc.lng });
    bounds.extend({ lat: placeLat, lng: placeLng });
    map.fitBounds(bounds, 60);
    
    // ×”×•×¡×¤×ª ×§×• ××§×•×•×§×• ×‘×™×Ÿ ×”××™×§×•××™×
    if (window.relativeLine) {
        window.relativeLine.setMap(null);
    }
    
    window.relativeLine = new google.maps.Polyline({
        path: [
            { lat: userLoc.lat, lng: userLoc.lng },
            { lat: placeLat, lng: placeLng }
        ],
        geodesic: true,
        strokeColor: '#1a73e8',
        strokeOpacity: 0.8,
        strokeWeight: 3,
        icons: [{
            icon: { path: 'M 0,-1 0,1', strokeOpacity: 1, scale: 3 },
            offset: '0',
            repeat: '15px'
        }],
        map: map
    });
    
    // ××—×™×§×ª ×”×§×• ××—×¨×™ 10 ×©× ×™×•×ª
    setTimeout(() => {
        if (window.relativeLine) {
            window.relativeLine.setMap(null);
            window.relativeLine = null;
        }
    }, 10000);
    
    const d = dist(userLoc.lat, userLoc.lng, placeLat, placeLng);
    toast(`ğŸ“ ${fmtDist(d)} ×××™×§×•××š`);
}

// ×¤×•× ×§×¦×™×” ×œ×¦×¤×™×™×” ×‘××¤×” ×©×œ× ×•
function viewOnOurMap(lat, lng) {
    closeSheet();
    setView('map');
    map.panTo({ lat, lng });
    map.setZoom(18);
}
    function closeSheet() {
        document.getElementById('sheet').classList.remove('open');
        document.getElementById('overlay').classList.remove('visible');
        selected = null;
        selectedIdx = -1;
    }
    
    function editSelectedPlace() {
        const idx = selectedIdx; // ×©×•××¨×™× ××ª ×”××™× ×“×§×¡ ×‘×¦×“ ×œ×¤× ×™ ×©×¡×•×’×¨×™×
        
        // ×•×™×“×•× ×©×™×© ×œ× ×• ××™× ×“×§×¡ ×ª×§×™×Ÿ
        if (idx === undefined || idx === -1) {
            // ×× ×–×” ××§×•× ××’×•×’×œ (×œ× ×©××•×¨), × ×¤×ª×— ×”×•×¡×¤×”
            if (selected && selected.isGoogle) {
                addGooglePlaceToMyList();
            } else {
                toast('×œ× × ×™×ª×Ÿ ×œ×¢×¨×•×š ××§×•× ×–×”');
            }
            return;
        }
        
        closeSheet(); // ×¡×•×’×¨×™× ××ª ×”×—×œ×•× ×™×ª
        editPlace(idx); // ×¤×•×ª×—×™× ×¢×¨×™×›×” ×¢× ×”××™× ×“×§×¡ ×©×©××¨× ×•
    }
    
    function toggleGoogle() {
        document.getElementById('googleEmbed').classList.toggle('visible');
        document.getElementById('googleArrow').classList.toggle('expanded');
    }
    
    function navigate() {
        if (!selected) return;
        navigateToCoords(selected.lat, selected.lng);
    }
    
    function navigateToCoords(lat, lng) {
        const d = `${lat},${lng}`;
        if (/iPhone|iPad|iPod/.test(navigator.userAgent)) window.location.href = `maps://maps.apple.com/?daddr=${d}&dirflg=w`;
        else window.open(`https://www.google.com/maps/dir/?api=1&destination=${d}&travelmode=walking`, '_blank');
    }
    
    function share() {
        if (!selected) return;
        const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(selected.name + ' Prague')}`;
        if (navigator.share) navigator.share({ title: selected.name, text: selected.description || selected.category, url }).catch(() => {});
        else { navigator.clipboard.writeText(`${selected.name}\n${selected.category}\n${url}`).then(() => toast('×”×§×™×©×•×¨ ×”×•×¢×ª×§!')); }
    }
    
    function searchPhotos() { if (selected) searchPhotosFor(selected.name); }
    function searchPhotosFor(name) { window.open(`https://www.google.com/search?tbm=isch&q=${encodeURIComponent(name + ' Prague')}`, '_blank'); }
    
    // === EDITOR ===
    function openEditor() { document.getElementById('editorModal').classList.add('open'); editorPlaceSearch = ''; editorCatSearch = ''; renderEditorTab('places'); }
    function closeEditor() { document.getElementById('editorModal').classList.remove('open'); }
    
    function renderEditorTab(tab) {
    const b = document.getElementById('editorBody');
    
    // ×× ×× ×—× ×• ×‘×œ×©×•× ×™×ª ××§×•××•×ª, × ×¤×¨×™×“ ××ª ×™×¦×™×¨×ª ×”×—×™×¤×•×© ××™×¦×™×¨×ª ×”×¨×©×™××”
    if (tab === 'places') {
        // ×¦×¢×“ 1: ×™×¦×™×¨×ª ×”××‘× ×” ×”×‘×¡×™×¡×™ ×¨×§ ×× ×”×•× ×œ× ×§×™×™×
        if (!document.getElementById('editorListContainer')) {
            b.innerHTML = `
                <div class="editor-search">
                    <input type="text" id="editorSearchInput" placeholder="ğŸ” ×—×¤×© ××§×•× ×‘×¨×©×™××”..." value="${editorPlaceSearch}">
                </div>
                <button class="add-btn" onclick="openAddPlace()">â• ×”×•×¡×£ ××§×•× ×—×“×©</button>
                <div id="editorListContainer"></div>
            `;
            
            // ×××–×™×Ÿ ×œ××™×¨×•×¢ ×”×§×œ×“×” ×©×œ× ××¨×¢× ×Ÿ ××ª ×›×œ ×”-HTML
            document.getElementById('editorSearchInput').oninput = (e) => {
                editorPlaceSearch = e.target.value;
                renderPlacesList(); // ×¨×§ ××¨×¢× ×Ÿ ××ª ×”×¨×©×™××”
            };
        }
        
        // ×¦×¢×“ 2: ×¨×™× ×“×•×¨ ×”×¨×©×™××”
        renderPlacesList();
        
    } else if (tab === 'cats') {
        // ××•×ª×• ×˜×¨×™×§ ×œ×§×˜×’×•×¨×™×•×ª
         let filtered = Object.entries(cats);
        if (editorCatSearch) {
            filtered = filtered.filter(([n]) => n.toLowerCase().includes(editorCatSearch.toLowerCase()));
        }
        b.innerHTML = `
            <div class="editor-search">
                <input type="text" placeholder="ğŸ” ×—×¤×© ×§×˜×’×•×¨×™×”..." value="${editorCatSearch}" oninput="editorCatSearch=this.value;renderEditorTab('cats')">
            </div>
            <button class="add-btn" onclick="openAddCat()">â• ×”×•×¡×£ ×§×˜×’×•×¨×™×”</button>
        ` + filtered.map(([n, c]) => {
            const cnt = places.filter(p => p.category === n).length;
            return `<div class="editor-item">
                <div class="editor-icon" style="background:${c.color}20">${c.icon}</div>
                <div class="editor-info"><div class="editor-name">${n}</div><div class="editor-meta">${cnt} ××§×•××•×ª</div></div>
                <div class="editor-actions">
                    <button class="editor-btn edit" onclick="editCat('${n.replace(/'/g, "\\'")}')">âœï¸</button>
                    <button class="editor-btn delete" onclick="delCat('${n.replace(/'/g, "\\'")}')">ğŸ—‘ï¸</button>
                </div>
            </div>`;
        }).join('');
    } else {
        // ×”×’×“×¨×•×ª
        b.innerHTML = `
            <div class="form-group"><label class="form-label">×™×™×¦×•× × ×ª×•× ×™×</label><button class="add-btn" onclick="exportData()">ğŸ“¤ ×™×™×¦× JSON</button></div>
            <div class="form-group"><label class="form-label">×™×™×‘×•× × ×ª×•× ×™×</label><input type="file" accept=".json" onchange="importData(event)" style="display:none" id="importFile"><button class="add-btn" onclick="document.getElementById('importFile').click()">ğŸ“¥ ×™×™×‘× JSON</button></div>
            <div class="form-group"><label class="form-label">××™×¤×•×¡</label><button class="add-btn" style="border-color:var(--error);color:var(--error)" onclick="resetData()">ğŸ—‘ï¸ ××¤×¡ ×œ×‘×¨×™×¨×ª ××—×“×œ</button></div>
        `;
    }
}

// ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×—×“×©×” ×œ×¨×©×™××” ×›×“×™ ×œ×× ×•×¢ ××ª ×‘××’ ×”××§×œ×“×ª
function renderPlacesList() {
    const container = document.getElementById('editorListContainer');
    if (!container) return;

    let filtered = places;
    if (editorPlaceSearch) {
        filtered = places.filter(p => 
            p.name.toLowerCase().includes(editorPlaceSearch.toLowerCase()) ||
            p.category.toLowerCase().includes(editorPlaceSearch.toLowerCase())
        );
    }

    container.innerHTML = filtered.map((p, i) => {
        const realIdx = places.indexOf(p);
        const cfg = cats[p.category] || { icon: 'ğŸ“', color: '#999' };
        return `<div class="editor-item">
            <div class="editor-icon" style="background:${cfg.color}20">${cfg.icon}</div>
            <div class="editor-info"><div class="editor-name">${p.name}</div><div class="editor-meta">${p.category}</div></div>
            <div class="editor-actions">
                <button class="editor-btn edit" onclick="editPlace(${realIdx})">âœï¸</button>
                <button class="editor-btn delete" onclick="delPlace(${realIdx})">ğŸ—‘ï¸</button>
            </div>
        </div>`;
    }).join('');
}
    
    // === PLACE CRUD ===
    function openAddPlace() {
        editIdx = -1;
        document.getElementById('placeModalTitle').textContent = '×”×•×¡×£ ××§×•×';
        document.getElementById('pName').value = '';
        document.getElementById('pDesc').value = '';
        document.getElementById('pLat').value = '';
        document.getElementById('pLng').value = '';
        document.getElementById('pCat').innerHTML = Object.keys(cats).map(c => `<option value="${c}">${cats[c].icon} ${c}</option>`).join('');
        document.getElementById('googleSearchInput').value = '';
        document.getElementById('googleSearchResults').innerHTML = '';
        document.getElementById('placeModal').classList.add('open');
    }
    
    function editPlace(i) {
        editIdx = i;
        const p = places[i];
        document.getElementById('placeModalTitle').textContent = '×¢×¨×•×š ××§×•×';
        document.getElementById('pName').value = p.name;
        document.getElementById('pDesc').value = p.description || '';
        document.getElementById('pLat').value = p.lat;
        document.getElementById('pLng').value = p.lng;
        document.getElementById('pCat').innerHTML = Object.keys(cats).map(c => `<option value="${c}" ${c===p.category?'selected':''}>${cats[c].icon} ${c}</option>`).join('');
        document.getElementById('googleSearchInput').value = '';
        document.getElementById('googleSearchResults').innerHTML = '';
        document.getElementById('placeModal').classList.add('open');
    }
    
    function closePlaceModal() { document.getElementById('placeModal').classList.remove('open'); }
    
    function savePlace() {
        const name = document.getElementById('pName').value.trim();
        const category = document.getElementById('pCat').value;
        const description = document.getElementById('pDesc').value.trim();
        const lat = parseFloat(document.getElementById('pLat').value);
        const lng = parseFloat(document.getElementById('pLng').value);
        
        if (!name || isNaN(lat) || isNaN(lng)) { toast('× × ×œ××œ× ×©× ×•×§×•××•×¨×“×™× ×˜×•×ª'); return; }
        
        if (editIdx >= 0) places[editIdx] = { name, category, description, lat, lng };
        else places.push({ name, category, description, lat, lng });
        
        save(); closePlaceModal(); renderCats(); renderMarkers(); renderList(); 
        if (document.getElementById('editorModal').classList.contains('open')) renderEditorTab('places');
        toast('×”××§×•× × ×©××¨!');
    }
    
    function delPlace(i) {
        if (confirm('×œ××—×•×§ ××ª ×”××§×•×?')) {
            places.splice(i, 1);
            save(); renderCats(); renderMarkers(); renderList(); renderEditorTab('places'); toast('×”××§×•× × ××—×§');
        }
    }
    
    function searchGoogleForAdd(val) {
        if (val.length < 2) { document.getElementById('googleSearchResults').innerHTML = ''; return; }
        
        const service = new google.maps.places.PlacesService(map);
        service.textSearch({
            query: val + ' Prague',
            location: PRAGUE_CENTER,
            radius: 10000
        }, (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                document.getElementById('googleSearchResults').innerHTML = results.slice(0, 5).map(r => `
                    <div class="search-result-item" onclick="fillFromGoogle('${r.place_id}')" style="border-bottom:1px solid var(--border);">
                        <div class="search-result-icon google">ğŸ“</div>
                        <div class="search-result-info">
                            <div class="search-result-name">${r.name}</div>
                            <div class="search-result-meta">${r.formatted_address || ''}</div>
                        </div>
                    </div>
                `).join('');
            }
        });
    }
    
    function fillFromGoogle(placeId) {
        const service = new google.maps.places.PlacesService(map);
        service.getDetails({
            placeId: placeId,
            fields: ['name', 'geometry']
        }, (place, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                document.getElementById('pName').value = place.name;
                document.getElementById('pLat').value = place.geometry.location.lat();
                document.getElementById('pLng').value = place.geometry.location.lng();
                document.getElementById('googleSearchResults').innerHTML = '';
                document.getElementById('googleSearchInput').value = '';
                toast('×”×¤×¨×˜×™× ×”×•×¢×ª×§×•!');
            }
        });
    }
    
    // === CATEGORY CRUD ===
    function openAddCat() {
        editCatId = null;
        selEmoji = 'ğŸ“'; selColor = '#1a73e8';
        document.getElementById('catModalTitle').textContent = '×”×•×¡×£ ×§×˜×’×•×¨×™×”';
        document.getElementById('cName').value = '';
        renderPickers();
        document.getElementById('catModal').classList.add('open');
    }
    
    function editCat(n) {
        editCatId = n;
        const c = cats[n];
        selEmoji = c.icon; selColor = c.color;
        document.getElementById('catModalTitle').textContent = '×¢×¨×•×š ×§×˜×’×•×¨×™×”';
        document.getElementById('cName').value = n;
        renderPickers();
        document.getElementById('catModal').classList.add('open');
    }
    
    function closeCatModal() { document.getElementById('catModal').classList.remove('open'); }
    
    function renderPickers() {
        document.getElementById('emojiInput').value = selEmoji;
        document.getElementById('emojiPicker').innerHTML = emojis.map(e => `<button class="picker-item ${e===selEmoji?'selected':''}" onclick="selEmoji='${e}';renderPickers()">${e}</button>`).join('');
        document.getElementById('colorPicker').innerHTML = colors.map(c => `<button class="color-item ${c===selColor?'selected':''}" style="background:${c}" onclick="selColor='${c}';renderPickers()"></button>`).join('');
        
        // ×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ××”×©×“×”
        document.getElementById('emojiInput').oninput = function() {
            if (this.value) {
                selEmoji = this.value;
                document.querySelectorAll('.picker-item').forEach(item => item.classList.remove('selected'));
            }
        };
    }
    
    function saveCat() {
        const name = document.getElementById('cName').value.trim();
        const emojiFromInput = document.getElementById('emojiInput').value.trim();
        if (emojiFromInput) selEmoji = emojiFromInput;
        if (!name) { toast('× × ×œ×”×–×™×Ÿ ×©×'); return; }
        
        if (editCatId && editCatId !== name) {
            places.forEach(p => { if (p.category === editCatId) p.category = name; });
            delete cats[editCatId];
        }
        
        cats[name] = { icon: selEmoji, color: selColor };
        save(); closeCatModal(); renderCats(); renderMarkers(); renderEditorTab('cats'); toast('×”×§×˜×’×•×¨×™×” × ×©××¨×”!');
    }
    
    function delCat(n) {
        const cnt = places.filter(p => p.category === n).length;
        if (cnt > 0) { toast(`×œ× × ×™×ª×Ÿ - ×™×© ${cnt} ××§×•××•×ª`); return; }
        if (confirm('×œ××—×•×§?')) { delete cats[n]; save(); renderCats(); renderEditorTab('cats'); toast('× ××—×§'); }
    }
    
    // === IMPORT/EXPORT ===
    function exportData() {
        const blob = new Blob([JSON.stringify({ places, cats }, null, 2)], { type: 'application/json' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'prague-map.json'; a.click();
        toast('×”×§×•×‘×¥ ×™×•×¨×“!');
    }
    
    function importData(e) {
        const f = e.target.files[0]; if (!f) return;
        const r = new FileReader();
        r.onload = ev => {
            try {
                const d = JSON.parse(ev.target.result);
                if (d.places) places = d.places;
                if (d.cats) cats = d.cats;
                save(); // ×©×•××¨ ×œ-Firebase - ×™×¡×•× ×›×¨×Ÿ ×œ×›×œ ×”××©×ª××©×™×
                renderCats(); renderMarkers(); renderList(); 
                toast('×”× ×ª×•× ×™× ×™×•×‘××• ×•×¡×•× ×›×¨× ×•!');
            } catch { toast('×©×’×™××” ×‘×§×•×‘×¥'); }
        };
        r.readAsText(f);
    }
    
    function resetData() {
        if (confirm('×œ××¤×¡ ×”×›×œ?')) {
            places = JSON.parse(JSON.stringify(initialData));
            cats = JSON.parse(JSON.stringify(defaultCats));
            save(); // ×©×•××¨ ×œ-Firebase
            renderCats(); renderMarkers(); renderList(); toast('×”× ×ª×•× ×™× ××•×¤×¡×•!');
        }
    }
    
    // === UTILS ===
    function dist(lat1, lng1, lat2, lng2) {
        const R = 6371, dLat = (lat2-lat1)*Math.PI/180, dLng = (lng2-lng1)*Math.PI/180;
        const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }
    
    function fmtDist(km) { return km < 1 ? `${Math.round(km*1000)} ×'` : `${km.toFixed(1)} ×§"×`; }
    
    function toast(msg) {
        const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('visible');
        setTimeout(() => t.classList.remove('visible'), 3000);
    }
    </script>  
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTcnkFPH0BwuUeYcmU-8BpQqz3E-XxX9M&libraries=places,marker&callback=initMap&v=weekly&loading=async" async defer></script>
</body>
</html>
